<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
   
  <meta name="keywords" content="IT，Life" />
   
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>
     Spark的博客
  </title>
  <meta name="generator" content="hexo-theme-yilia-plus">
  
  <link rel="shortcut icon" href="/favicon.ico" />
  
  <link rel="stylesheet" href="/css/style.css">
  <script src="/js/pace.min.js"></script>

  

  

</head>

</html>

<body>
  <div id="app">
    <main class="content">
      
<section class="cover">
    
      
      <a class="forkMe" href="https://github.com/Shen-Yu/hexo-theme-ayer" target="_blank"><img width="149" height="149" src="/images/forkme.png" class="attachment-full size-full" alt="Fork me on GitHub" data-recalc-dims="1"></a>
    
  <div class="cover-frame">
    <div class="bg-box">
      <img src="/images/cover1.jpg" alt="image frame">
    </div>
    <div class="cover-inner text-center text-white">
      <h1><a href="/">Spark的博客</a></h1>
      <h2>一生挨踢，永远学习，坚守信仰，简单活着</h2>
      <div>
        
      </div>
    </div>
  </div>
  <div class="cover-learn-more">
    <a href="javascript:void(0)" class="anchor"><i class="ri-arrow-down-line"></i></a>
  </div>
</section>

<div id="main">
  <section class="outer">
  <article class="articles">
    
    
    
    
    <article id="post-ssh 认证过程" class="article article-type-post" itemscope="" itemprop="blogPost" data-scroll-reveal="">

  <div class="article-inner">
    

    
    <div class="article-meta">
      <a href="/2019/10/24/ssh 认证过程/" class="article-date">
  <time datetime="2019-10-24T03:44:03.812Z" itemprop="datePublished">2019-10-24</time>
</a>
      
      
      
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      


      

      
      <p><img src="https://spark-1300032833.cos.ap-guangzhou.myqcloud.com/blog/2019-10-24-l00ehS.png" alt=""></p>

      
      <!-- 打赏 -->
      
    </div>
    <footer class="article-footer">
      <a data-url="http://csspark.github.io/2019/10/24/ssh 认证过程/" data-id="ck5d8fq3i000wgdgft4hxl7ql" class="article-share-link">分享</a>
      
    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-typescript上手实践" class="article article-type-post" itemscope="" itemprop="blogPost" data-scroll-reveal="">

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2019/10/22/typescript上手实践/">typescript上手实践</a>
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2019/10/22/typescript上手实践/" class="article-date">
  <time datetime="2019-10-22T02:43:13.000Z" itemprop="datePublished">2019-10-22</time>
</a>
      
      
      
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h3 id="typescript-工程构建"><a href="#typescript-工程构建" class="headerlink" title="typescript 工程构建"></a>typescript 工程构建</h3><ul>
<li>新建项目文件夹</li>
<li>npm init -y</li>
<li>npm i typescript -g</li>
<li>tsc –init</li>
</ul>

      
      <!-- 打赏 -->
      
    </div>
    <footer class="article-footer">
      <a data-url="http://csspark.github.io/2019/10/22/typescript上手实践/" data-id="ck5d8fq3k000ygdgf2mzw2mvc" class="article-share-link">分享</a>
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/typescript/">typescript</a></li></ul>

    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-ECMAscript6学习" class="article article-type-post" itemscope="" itemprop="blogPost" data-scroll-reveal="">

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2019/10/18/ECMAscript6学习/">ECMAscript6学习笔记</a>
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2019/10/18/ECMAscript6学习/" class="article-date">
  <time datetime="2019-10-18T03:32:15.000Z" itemprop="datePublished">2019-10-18</time>
</a>
      
      
      
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h3 id="var-let-const声明变量的区别"><a href="#var-let-const声明变量的区别" class="headerlink" title="var,let,const声明变量的区别"></a>var,let,const声明变量的区别</h3><table>
<thead>
<tr>
<th>类型</th>
<th>可重复声明</th>
<th>作用域</th>
<th>性质</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td> var</td>
<td>yes</td>
<td>函数级</td>
<td>变量</td>
<td></td>
</tr>
<tr>
<td> let</td>
<td>no</td>
<td>块级</td>
<td>变量</td>
</tr>
<tr>
<td> const</td>
<td>no</td>
<td>块级</td>
<td>常量</td>
</tr>
</tbody>
</table>
<h3 id="function-之类的写法"><a href="#function-之类的写法" class="headerlink" title="(function(){})()之类的写法"></a>(function(){})()之类的写法</h3><p>名称：自执行匿名函数</p>
<p>目的：因为一般变量只要不是window下的全局变量或函数，最大的作用域也是函数级别，所以可以利用匿名函数创建一个命名空间。可以达到匿名和自动执行的功能，这也是各大js类库的做法</p>
<p>问题：为什么要把闭包函数用括号包起来？</p>
<pre><code>答案：是为了让一个函数的生命变成一个表达式从而合法，如果没有外面的括号包围，会导致函数的生命和调用在一起，让解释器莫名其妙，理解括号的意义之后，就知道很多变种的写法都是一个道理，比如：赋值，逻辑，甚至是逗号，各种操作符
(function(){alert(&apos;iifksp&apos;)})()       // true
!function(){alert(&apos;iifksp&apos;)}()        // true
+function(){alert(&apos;iifksp&apos;)}()        // NaN
-function(){alert(&apos;iifksp&apos;)}()        // NaN
var i = function(){alert(&apos;iifksp&apos;)}() // undefined 
...
</code></pre><p>从性能和兼容上来说，建议使用列出的情况之一</p>
<h3 id="箭头函数"><a href="#箭头函数" class="headerlink" title="箭头函数"></a>箭头函数</h3><p>目的：1、简化，2、修正this</p>
<p>具体：<br>当参数只有一个的时候()可以省略<br>当只有一个return 语句的时候{}可以省略<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">function test(var i)&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line">let test=()=&gt;&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>this指向是其父作用域，普通写法指向调用的对象本身</p>
<h3 id="异步三部曲"><a href="#异步三部曲" class="headerlink" title="异步三部曲"></a>异步三部曲</h3><p>promise，generator/yield,async/await</p>
<p>一个本质，三个时代</p>
<p>目的为了实现封装异步的同时拥有同步编程的面孔，减少异步编程的复杂性</p>
<p>promise.all()请求很多个资源但不分先后<br>Promise.all().then(result=&gt;{},err=&gt;{})<br><!-- new promise((resolve,reject)=>{}) --></p>
<p>generator/yield用于处理有逻辑的异步请求<br>    function *name(){<br>        yield ……<br>    }<br>Async/Await<br>    Async function(){<br>        Await …..<br>    }</p>

      
      <!-- 打赏 -->
      
    </div>
    <footer class="article-footer">
      <a data-url="http://csspark.github.io/2019/10/18/ECMAscript6学习/" data-id="ck5d8fq2o0000gdgf6vkfjgki" class="article-share-link">分享</a>
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ECMAscript6/">ECMAscript6</a></li></ul>

    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-实时音视频文档" class="article article-type-post" itemscope="" itemprop="blogPost" data-scroll-reveal="">

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2019/09/17/实时音视频文档/">实时音视频文档</a>
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2019/09/17/实时音视频文档/" class="article-date">
  <time datetime="2019-09-17T02:22:52.000Z" itemprop="datePublished">2019-09-17</time>
</a>
      
      
      
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h1 id="接入流程"><a href="#接入流程" class="headerlink" title="接入流程"></a>接入流程</h1><h3 id="1、引入js文件"><a href="#1、引入js文件" class="headerlink" title="1、引入js文件"></a>1、引入js文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=&quot;https://rtc.visitong.com/js/WebAPI.min.js&quot;&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h3 id="2、检测是否支持-WebRTC"><a href="#2、检测是否支持-WebRTC" class="headerlink" title="2、检测是否支持 WebRTC"></a>2、检测是否支持 WebRTC</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">WebAPI.fn.detectRTC(&#123;</span><br><span class="line">    screenshare: false</span><br><span class="line">&#125;, function (info) &#123;</span><br><span class="line">    if (!info.support) &#123;</span><br><span class="line">        alert(&apos;不支持WebRTC&apos;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">&lt;script&gt;</span><br></pre></td></tr></table></figure>
<h3 id="3、初始化webRTC"><a href="#3、初始化webRTC" class="headerlink" title="3、初始化webRTC"></a>3、初始化webRTC</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">window.RTC = new WebAPI(&#123;</span><br><span class="line">    userId: 用户名,</span><br><span class="line">    userSig: 用户签名,从visitong服务端获取,见下面服务接口支持1</span><br><span class="line">    sdkAppId: 固定值,</span><br><span class="line">    accountType: 固定值1</span><br><span class="line">&#125;,function () &#123;</span><br><span class="line">    // 初始化回调函数</span><br><span class="line">    // 以下的4，5，6部分都应该在这里</span><br><span class="line">&#125;, function (error) &#123;</span><br><span class="line">    // 错误捕获</span><br><span class="line">    console.warn(&quot;init error&quot;, error)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="4、创建和进入音视频房间"><a href="#4、创建和进入音视频房间" class="headerlink" title="4、创建和进入音视频房间"></a>4、创建和进入音视频房间</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">//此处必须在上一个初始化webrtc的回调函数之内</span><br><span class="line">    RTC.enterRoom(&#123;</span><br><span class="line">        //房间ID只能是数字</span><br><span class="line">        roomid: opts.roomid * 1,</span><br><span class="line">        role: &quot;user&quot;,</span><br><span class="line">    &#125;, function (info) &#123;</span><br><span class="line">        console.warn(&quot;init succ&quot;, info)</span><br><span class="line">        </span><br><span class="line">    &#125;, function (error) &#123;</span><br><span class="line">        &lt;!-- 初始化错误捕获 --&gt;</span><br><span class="line">        console.error(&quot;init error&quot;, error)</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>
<h3 id="5、获取本地化视频流"><a href="#5、获取本地化视频流" class="headerlink" title="5、获取本地化视频流"></a>5、获取本地化视频流</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">RTC.getLocalStream(&#123;</span><br><span class="line">    video: true,</span><br><span class="line">    audio: true,</span><br><span class="line">    videoDevice: opt.videoDevice,</span><br><span class="line">&#125;, function (info) &#123;</span><br><span class="line">    &lt;!-- 回调返回当前用户流名 --&gt;</span><br><span class="line">    var stream = info.stream;</span><br><span class="line">    succ(stream)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="6、开始推流"><a href="#6、开始推流" class="headerlink" title="6、开始推流"></a>6、开始推流</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">RTC.startRTC(&#123;</span><br><span class="line">    stream: stream,</span><br><span class="line">    role: &apos;user&apos;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="7、远端视频流渲染"><a href="#7、远端视频流渲染" class="headerlink" title="7、远端视频流渲染"></a>7、远端视频流渲染</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">RTC.on(&quot;onRemoteStreamUpdate&quot;, onRemoteStreamUpdate)</span><br><span class="line"></span><br><span class="line">function onRemoteStreamUpdate(info) &#123;</span><br><span class="line">    console.debug(info);</span><br><span class="line">    if (info.stream &amp;&amp; info.stream.active === true) &#123;</span><br><span class="line">        var id = info.videoId;</span><br><span class="line">        var video = document.getElementById(id);</span><br><span class="line">        if (!video) &#123;</span><br><span class="line">            video = createVideoElement(id);</span><br><span class="line">        &#125;</span><br><span class="line">        video.srcObject = info.stream;</span><br><span class="line">        $(&quot;#client&quot;).html(info.userId); </span><br><span class="line">            // 混流</span><br><span class="line"></span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        console.log(&apos;欢迎用户&apos; + info.userId + &apos;加入房间&apos;);</span><br><span class="line">    &#125;    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="8、远端下线提醒"><a href="#8、远端下线提醒" class="headerlink" title="8、远端下线提醒"></a>8、远端下线提醒</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">RTC.on(&quot;onRemoteStreamRemove&quot;, onRemoteStreamRemove)</span><br><span class="line"></span><br><span class="line">function onRemoteStreamRemove(info) &#123;</span><br><span class="line">console.log(info.userId + &apos; 断开了连接&apos;);</span><br><span class="line">var videoNode = document.getElementById(info.videoId);</span><br><span class="line">if (videoNode) &#123;</span><br><span class="line">    videoNode.srcObject = null;</span><br><span class="line">    document.getElementById(info.videoId).parentElement.removeChild(videoNode);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="更多事件和功能见下面demo"><a href="#更多事件和功能见下面demo" class="headerlink" title="更多事件和功能见下面demo"></a>更多事件和功能见下面demo</h3><h1 id="服务接口支持"><a href="#服务接口支持" class="headerlink" title="服务接口支持"></a>服务接口支持</h1><h3 id="1、获取用户签名"><a href="#1、获取用户签名" class="headerlink" title="1、获取用户签名"></a>1、获取用户签名</h3><table>
<thead>
<tr>
<th>参数名</th>
<th>类型</th>
<th>是否必须</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>type</td>
<td>string</td>
<td>yes</td>
<td>ajax操作类型</td>
</tr>
<tr>
<td>user_id</td>
<td>string</td>
<td>yes</td>
<td>用户名</td>
</tr>
</tbody>
</table>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$.ajax(&#123;</span><br><span class="line">    type: &apos;post&apos;,</span><br><span class="line">    url: &apos;https://rtc.visitong.com/ajax.php&apos;,</span><br><span class="line">    data: &#123; type: &quot;rtc_user_sign&quot;, user_id: user_id &#125;,</span><br><span class="line">    dataType: &apos;json&apos;,</span><br><span class="line">    success: function (res) &#123;</span><br><span class="line">        $(&apos;#c_roomid&apos;).html(roomid);</span><br><span class="line">        $(&apos;#customer&apos;).html(userId);</span><br><span class="line">        $(&quot;#video-section&quot;).show();</span><br><span class="line">        initRTC(&#123;</span><br><span class="line">            &quot;userId&quot;: userId,</span><br><span class="line">            &quot;userSig&quot;: res.userSig,</span><br><span class="line">            &quot;sdkappid&quot;: 1400257833,</span><br><span class="line">            &quot;accountType&quot;: 1,</span><br><span class="line">            &quot;roomid&quot;: roomid</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="2、获取独立画面视频流地址"><a href="#2、获取独立画面视频流地址" class="headerlink" title="2、获取独立画面视频流地址"></a>2、获取独立画面视频流地址</h3><table>
<thead>
<tr>
<th>参数名</th>
<th>类型</th>
<th>是否必须</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>type</td>
<td>string</td>
<td>yes</td>
<td>ajax操作类型</td>
</tr>
<tr>
<td>room_id</td>
<td>int</td>
<td>yes</td>
<td>房间id</td>
</tr>
<tr>
<td>user_id</td>
<td>string</td>
<td>yes</td>
<td>用户名</td>
</tr>
</tbody>
</table>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$.ajax(&#123;</span><br><span class="line">    type:&apos;post&apos;,</span><br><span class="line">    url:&apos;https://rtc.visitong.com/ajax.php&apos;,</span><br><span class="line">    data:&#123;type:&quot;get_user_stream&quot;,room_id: room_id,user_id:user_id&#125;,</span><br><span class="line">    dataType:&apos;json&apos;,</span><br><span class="line">    success:function(res)&#123;</span><br><span class="line">        $(&quot;#stream_url&quot;).html(res.stream);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="3、混流接口"><a href="#3、混流接口" class="headerlink" title="3、混流接口"></a>3、混流接口</h3><ul>
<li>输入参数说明</li>
</ul>
<table>
<thead>
<tr>
<th>参数名</th>
<th>类型</th>
<th>是否必须</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>type</td>
<td>string</td>
<td>yes</td>
<td>ajax操作类型</td>
</tr>
<tr>
<td>room_id</td>
<td>int</td>
<td>yes</td>
<td>房间id</td>
</tr>
<tr>
<td>customer</td>
<td>string</td>
<td>yes</td>
<td>客服用户名</td>
</tr>
<tr>
<td>client</td>
<td>string</td>
<td>yes</td>
<td>客户用户名</td>
</tr>
</tbody>
</table>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$.ajax(&#123;</span><br><span class="line">    type:&apos;post&apos;,</span><br><span class="line">    url:&apos;https://rtc.visitong.com/ajax.php&apos;,</span><br><span class="line">    data:&#123;type: &quot;mix_stream&quot;,room_id: room_id,customer: &quot;customer&quot;,client: info.userId&#125;,</span><br><span class="line">    dataType:&apos;json&apos;,</span><br><span class="line">    success:function(res)&#123;</span><br><span class="line">        console.log(res)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li>返回参数说明</li>
</ul>
<table>
<thead>
<tr>
<th>参数名</th>
<th>参数值示例</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>code</td>
<td>100或其他数字</td>
<td>100为混流成功代码，其他为未成功</td>
</tr>
<tr>
<td>msg</td>
<td>success或其他</td>
<td>接口返回消息</td>
</tr>
<tr>
<td>session_id</td>
<td>dgeowlj67er</td>
<td>混流会话ID，需要业务保存这个ID,不成功则没有</td>
</tr>
<tr>
<td>stream</td>
<td>2df3fcs6nm</td>
<td>合并流名，不成功则没有</td>
</tr>
</tbody>
</table>
<h3 id="4、取消合流"><a href="#4、取消合流" class="headerlink" title="4、取消合流"></a>4、取消合流</h3><ul>
<li>输入参数说明</li>
</ul>
<table>
<thead>
<tr>
<th>参数名</th>
<th>类型</th>
<th>是否必须</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>type</td>
<td>string</td>
<td>yes</td>
<td>ajax操作类型</td>
</tr>
<tr>
<td>session_id</td>
<td>string</td>
<td>yes</td>
<td>混流会话id</td>
</tr>
<tr>
<td>stream</td>
<td>string</td>
<td>yes</td>
<td>混流流名</td>
</tr>
</tbody>
</table>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$.ajax(&#123;</span><br><span class="line">        type:&apos;post&apos;,//get或post</span><br><span class="line">        url:&apos;https://rtc.visitong.com/ajax.php&apos;,</span><br><span class="line">        data:&#123;type: &quot;cancel_mix_stream&quot;,session_id:session_id,stream:stream&#125;,</span><br><span class="line">        dataType:&apos;json&apos;,</span><br><span class="line">        success:function(res)&#123;</span><br><span class="line">            console.log(res)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li>返回参数说明</li>
</ul>
<table>
<thead>
<tr>
<th>参数名</th>
<th>参数值示例</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>code</td>
<td>100或其他数字</td>
<td>100为混流成功代码，其他为未成功</td>
</tr>
<tr>
<td>msg</td>
<td>success或其他</td>
<td>接口返回消息</td>
</tr>
</tbody>
</table>
<h1 id="demo文件"><a href="#demo文件" class="headerlink" title="demo文件"></a>demo文件</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class="line">    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot;&gt;</span><br><span class="line">    &lt;title&gt;webRTC demo&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;p&gt;当前房间号：&lt;span id=&quot;c_roomid&quot;&gt;&lt;/span&gt; 当前用户： &lt;span id=&quot;customer&quot;&gt;&lt;/span&gt;当前客户：&lt;span id=&quot;client&quot;&gt;&lt;/span&gt; 当前流：&lt;span id=&quot;stream_url&quot;&gt;&lt;/span&gt;&lt;/p&gt;</span><br><span class="line">    &lt;p&gt;&lt;button id=&quot;mix_stream&quot;&gt;混流&lt;/button&gt;&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 视频流展示区域 --&gt;</span><br><span class="line">    &lt;div id=&quot;video-section&quot; style=&quot;display: none&quot;&gt;</span><br><span class="line">        &lt;div id=&quot;remote-video-wrap&quot;&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;script src=&quot;./libs/jquery.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script src=&quot;https://rtc.visitong.com/js/WebAPI.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script&gt;</span><br><span class="line">        var html = &apos;u&apos; + Math.floor(Math.random() * 10000);</span><br><span class="line">        var roomid = 113356;</span><br><span class="line">        var userId = html;</span><br><span class="line">        // 检查浏览器环境是否支持WebRTC</span><br><span class="line">        WebAPI.fn.detectRTC(&#123;</span><br><span class="line">            screenshare: false</span><br><span class="line">        &#125;, function (info) &#123;</span><br><span class="line">            if (!info.support) &#123;</span><br><span class="line">                alert(&apos;不支持WebRTC&apos;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        // 触发webTC的初始化以及房间创建、本地化推流</span><br><span class="line">        push();</span><br><span class="line">        </span><br><span class="line">        // 踢出房间执行函数</span><br><span class="line">        function onKickout() &#123;</span><br><span class="line">            alert(&quot;on kick out!&quot;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // 退出webRTC 执行函数</span><br><span class="line">        function quitRTC() &#123;</span><br><span class="line">            RTC.quit();</span><br><span class="line">            $(&quot;#video-section&quot;).hide();</span><br><span class="line">            $(&quot;#remote-video-wrap&quot;).html(&quot;&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        // 服务器超时执行函数</span><br><span class="line">        function onRelayTimeout(msg) &#123;</span><br><span class="line">            alert(&quot;onRelayTimeout!&quot; + (msg ? JSON.stringify(msg) : &quot;&quot;));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // 渲染视频执行函数，用在本地和远程视频流加入房间的时候</span><br><span class="line">        function createVideoElement(id, isLocal) &#123;</span><br><span class="line">            var videoDiv = document.createElement(&quot;div&quot;);</span><br><span class="line">            videoDiv.innerHTML = &apos;&lt;video id=&quot;&apos; + id + &apos;&quot; autoplay &apos; + (isLocal ? &apos;muted&apos; : &apos;&apos;) + &apos; playsinline &gt;&lt;/video&gt;&apos;;</span><br><span class="line">            document.querySelector(&quot;#remote-video-wrap&quot;).appendChild(videoDiv);</span><br><span class="line">            return document.getElementById(id);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        // 本地视频流渲染</span><br><span class="line">        function onLocalStreamAdd(info) &#123;</span><br><span class="line">            if (info.stream &amp;&amp; info.stream.active === true) &#123;</span><br><span class="line">                var id = &quot;local&quot;;</span><br><span class="line">                var video = document.getElementById(id);</span><br><span class="line">                if (!video) &#123;</span><br><span class="line">                    createVideoElement(id, true);</span><br><span class="line">                &#125;</span><br><span class="line">                var video = document.getElementById(id)</span><br><span class="line">                video.srcObject = info.stream;</span><br><span class="line">                video.muted = true</span><br><span class="line">                video.autoplay = true</span><br><span class="line">                video.playsinline = true</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // 加入房间的用户视频流</span><br><span class="line">        function onRemoteStreamUpdate(info) &#123;</span><br><span class="line">            console.debug(info)</span><br><span class="line">            if (info.stream &amp;&amp; info.stream.active === true) &#123;</span><br><span class="line">                var id = info.videoId;</span><br><span class="line">                var video = document.getElementById(id);</span><br><span class="line">                if (!video) &#123;</span><br><span class="line">                    video = createVideoElement(id);</span><br><span class="line">                &#125;</span><br><span class="line">                video.srcObject = info.stream;</span><br><span class="line">                $(&quot;#client&quot;).html(info.userId);</span><br><span class="line">                </span><br><span class="line">                // 混流，只做示范，具体调用时机根据业务来定</span><br><span class="line">                setTimeout(function(info)&#123;</span><br><span class="line">                    $.ajax(&#123;</span><br><span class="line">                        type:&apos;post&apos;,//get或post</span><br><span class="line">                        url:&apos;https://rtc.visitong.com/ajax.php&apos;,</span><br><span class="line">                        data:&#123;type: &quot;mix_stream&quot;,room_id: roomid,customer: &quot;customer&quot;,client: info.userId&#125;,</span><br><span class="line">                        dataType:&apos;json&apos;,//text</span><br><span class="line">                        success:function(res)&#123;</span><br><span class="line">                            console.log(res)</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;)</span><br><span class="line">                &#125;,10000);</span><br><span class="line"></span><br><span class="line">            </span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                console.log(&apos;欢迎用户&apos; + info.userId + &apos;加入房间&apos;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        function onRemoteStreamRemove(info) &#123;</span><br><span class="line">            console.log(info.userId + &apos; 断开了连接&apos;);</span><br><span class="line">            var videoNode = document.getElementById(info.videoId);</span><br><span class="line">            if (videoNode) &#123;</span><br><span class="line">                videoNode.srcObject = null;</span><br><span class="line">                document.getElementById(info.videoId).parentElement.removeChild(videoNode);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        function onWebSocketClose() &#123;</span><br><span class="line">            RTC.quit();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        function gotStream(opt, succ) &#123;</span><br><span class="line">            RTC.getLocalStream(&#123;</span><br><span class="line">                video: true,</span><br><span class="line">                audio: true,</span><br><span class="line">                videoDevice: opt.videoDevice,</span><br><span class="line">                </span><br><span class="line">            &#125;, function (info) &#123;</span><br><span class="line">                var stream = info.stream;</span><br><span class="line">                succ(stream)</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        function initRTC(opts) &#123;</span><br><span class="line">            window.RTC = new WebAPI(&#123;</span><br><span class="line">                userId: opts.userId,</span><br><span class="line">                userSig: opts.userSig,</span><br><span class="line">                sdkAppId: opts.sdkappid,</span><br><span class="line">                accountType: opts.accountType</span><br><span class="line">            &#125;, function () &#123;</span><br><span class="line">                RTC.enterRoom(&#123;</span><br><span class="line">                    roomid: opts.roomid * 1,</span><br><span class="line">                    role: &quot;user&quot;,</span><br><span class="line">                &#125;, function (info) &#123;</span><br><span class="line">                    console.warn(&quot;init succ&quot;, info)</span><br><span class="line">                    gotStream(&#123;</span><br><span class="line">                        audio: true,</span><br><span class="line">                        video: true</span><br><span class="line">                    &#125;, function (stream) &#123;</span><br><span class="line">                        RTC.startRTC(&#123;</span><br><span class="line">                            stream: stream,</span><br><span class="line">                            role: &apos;user&apos;</span><br><span class="line">                        &#125;);</span><br><span class="line">                    &#125;)</span><br><span class="line">                &#125;, function (error) &#123;</span><br><span class="line">                    console.error(&quot;init error&quot;, error)</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;, function (error) &#123;</span><br><span class="line">                // console.warn(&quot;init error&quot;, error)</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">            // 远端流新增/更新</span><br><span class="line">            RTC.on(&quot;onRemoteStreamUpdate&quot;, onRemoteStreamUpdate)</span><br><span class="line">            // 本地流新增</span><br><span class="line">            RTC.on(&quot;onLocalStreamAdd&quot;, onLocalStreamAdd)</span><br><span class="line">            // 远端流断开</span><br><span class="line">            RTC.on(&quot;onRemoteStreamRemove&quot;, onRemoteStreamRemove)</span><br><span class="line">            // 重复登录被T</span><br><span class="line">            RTC.on(&quot;onKickout&quot;, onKickout)</span><br><span class="line">            // 服务器超时</span><br><span class="line">            RTC.on(&quot;onRelayTimeout&quot;, onRelayTimeout)</span><br><span class="line"></span><br><span class="line">            RTC.on(&quot;onErrorNotify&quot;, function (info) &#123;</span><br><span class="line">                console.error(info)</span><br><span class="line">                if (info.errorCode === RTC.getErrorCode().GET_LOCAL_CANDIDATE_FAILED) &#123;</span><br><span class="line">                    // alert( info.errorMsg )</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            RTC.on(&quot;onStreamNotify&quot;, function (info) &#123;</span><br><span class="line">                // console.warn(&apos;onStreamNotify&apos;, info)</span><br><span class="line">            &#125;);</span><br><span class="line">            RTC.on(&quot;onWebSocketNotify&quot;, function (info) &#123;</span><br><span class="line">                // console.warn(&apos;onWebSocketNotify&apos;, info)</span><br><span class="line">            &#125;);</span><br><span class="line">            RTC.on(&quot;onUserDefinedWebRTCEventNotice&quot;, function (info) &#123;</span><br><span class="line">                // console.error( &apos;onUserDefinedWebRTCEventNotice&apos;,info )</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        function push() &#123;</span><br><span class="line">            // 先获取用户签名</span><br><span class="line">            $.ajax(&#123;</span><br><span class="line">                type: &apos;post&apos;,//get或post</span><br><span class="line">                url: &apos;https://rtc.visitong.com/ajax.php&apos;,</span><br><span class="line">                data: &#123; type: &quot;rtc_user_sign&quot;, user_id: userId &#125;,</span><br><span class="line">                dataType: &apos;json&apos;,//text,j</span><br><span class="line">                success: function (res) &#123;</span><br><span class="line">                    $(&apos;#c_roomid&apos;).html(roomid);</span><br><span class="line">                    $(&apos;#customer&apos;).html(userId);</span><br><span class="line">                    $(&quot;#video-section&quot;).show();</span><br><span class="line">                    initRTC(&#123;</span><br><span class="line">                        &quot;userId&quot;: userId,</span><br><span class="line">                        &quot;userSig&quot;: res.userSig,</span><br><span class="line">                        &quot;sdkappid&quot;: 1400257833,</span><br><span class="line">                        &quot;accountType&quot;: 1, </span><br><span class="line">                        &quot;roomid&quot;: roomid</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line"></span><br><span class="line">            // 获取用户流地址，只做示范，实际生产中尽量用onLocalStreamAdd和onRemoteStreamUpdate代替，因为流地址延时大</span><br><span class="line">            </span><br><span class="line">            $.ajax(&#123;</span><br><span class="line">                type:&apos;post&apos;,//get或post</span><br><span class="line">                url:&apos;https://rtc.visitong.com/ajax.php&apos;,</span><br><span class="line">                data:&#123;type:&quot;get_user_stream&quot;,room_id: roomid,user_id:userId&#125;,</span><br><span class="line">                dataType:&apos;json&apos;,</span><br><span class="line">                success:function(res)&#123;</span><br><span class="line">                    $(&quot;#stream_url&quot;).html(res.stream);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        function audience() &#123;</span><br><span class="line">            login(true);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        function stopRTC() &#123;</span><br><span class="line">            RTC.stopRTC(0, function (info) &#123;</span><br><span class="line">                // console.debug(info)</span><br><span class="line">            &#125;, function (info) &#123;</span><br><span class="line">                // console.debug(info)</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        function stopWs() &#123;</span><br><span class="line">            RTC.global.websocket.close();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        function startRTC() &#123;</span><br><span class="line">            RTC.startRTC(0, function (info) &#123;</span><br><span class="line">                console.debug(&apos;success&apos;, info)</span><br><span class="line">            &#125;, function (info) &#123;</span><br><span class="line">                console.debug(&apos;failed&apos;, info)</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<h1 id="本地保存合流音视频"><a href="#本地保存合流音视频" class="headerlink" title="本地保存合流音视频"></a>本地保存合流音视频</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i http://thls.visitong.com/live/sdsdasdas2343.m3u8 -c:v copy -c:a copy -bsf:a aac_adtstoasc d:\cap.mp4</span><br></pre></td></tr></table></figure>

      
      <!-- 打赏 -->
      
    </div>
    <footer class="article-footer">
      <a data-url="http://csspark.github.io/2019/09/17/实时音视频文档/" data-id="ck5d8fq3t001egdgfggyrq2m6" class="article-share-link">分享</a>
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/webRTC/">webRTC</a></li></ul>

    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-微信小程序实践之直播推流" class="article article-type-post" itemscope="" itemprop="blogPost" data-scroll-reveal="">

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2019/09/17/微信小程序实践之直播推流/">微信小程序实践之直播推流</a>
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2019/09/17/微信小程序实践之直播推流/" class="article-date">
  <time datetime="2019-09-17T02:22:52.000Z" itemprop="datePublished">2019-09-17</time>
</a>
      
      
      
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h1 id="项目介绍"><a href="#项目介绍" class="headerlink" title="项目介绍"></a>项目介绍</h1><p>利用小程序实现一个直播推流工具，记录一下当中的几个上手的知识点</p>
<h2 id="表单数据获取"><a href="#表单数据获取" class="headerlink" title="表单数据获取"></a>表单数据获取</h2><blockquote>
<p>注意</p>
</blockquote>
<ul>
<li>所有的input  textarea button全部包含在form表单元素里</li>
<li>button  必须有formType=”submit” 这个属性</li>
<li>form 必须有提交事件  即bindsubmit=”back_houtai”</li>
<li>通过 name属性取值，name名称不可重复<blockquote>
<p>代码示例</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">wxml</span><br><span class="line">&lt;form bindsubmit=&quot;back_houtai&quot;&gt;</span><br><span class="line">    &lt;input placeholder=&apos;请输入总分&apos; cursor-spacing=&apos;20&apos; name=&apos;total_score&apos;&gt;&lt;/input&gt;</span><br><span class="line">    &lt;input placeholder=&apos;请输入初试专业课成绩&apos; cursor-spacing=&apos;20&apos; name=&apos;major_score&apos;&gt;</span><br><span class="line">    &lt;button class=&apos;subClass_btn2&apos; formType=&quot;submit&quot;&gt;确定&lt;/button&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">js</span><br><span class="line">data: &#123;</span><br><span class="line"></span><br><span class="line">&#125;,</span><br><span class="line">back_houtai: function (e) &#123;</span><br><span class="line">    var that = this;</span><br><span class="line">    var total_score = e.detail.value.total_score; //总分</span><br><span class="line">    var major_score = e.detail.value.major_score; //专业分</span><br><span class="line">    var enroll_date = e.detail.value.enroll_date; //年份</span><br><span class="line">    var self_intro = e.detail.value.self_intro; //个人介绍</span><br><span class="line">    console.log(total_score)</span><br><span class="line">    console.log(major_score)</span><br><span class="line">    console.log(enroll_date)</span><br><span class="line">    console.log(self_intro)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
</li>
</ul>
<h2 id="界面之间传值，取值"><a href="#界面之间传值，取值" class="headerlink" title="界面之间传值，取值"></a>界面之间传值，取值</h2><ul>
<li><p>url传值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">A页面</span><br><span class="line">// 方法一：navigator标签传值</span><br><span class="line">    &lt;navigator url=&quot;/page/index/index?id=110&quot; &gt;传值&lt;/navigator&gt;</span><br><span class="line">    &lt;navigator url=&quot;/page/index/index?id=110&amp;username=jane&amp;password=123456&quot; &gt;传值&lt;/navigator&gt;</span><br><span class="line"></span><br><span class="line">    // 方法二： wx.navigator标签传值单值、多值传递</span><br><span class="line">    wx.navigateTo(&#123;</span><br><span class="line">      url: &apos;/page/index/index?id=&apos; + id</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    wx.navigateTo(&#123;</span><br><span class="line">      url: &apos;/page/index/index?id=&apos; + id +&apos;&amp;username=&apos;+ username+&apos;&amp;password=&apos;+ password</span><br><span class="line">    &#125;)</span><br><span class="line">B页面</span><br><span class="line">onLoad: function (options) &#123;</span><br><span class="line">    var id = options.id;</span><br><span class="line">    this.setData(&#123;</span><br><span class="line">      id:id,</span><br><span class="line">      username:username,</span><br><span class="line">      password:password,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>
</li>
<li><p>本地存储</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 存 --&gt;</span><br><span class="line">wx.setStorageSync(&apos;user_info&apos;, dic);</span><br><span class="line">&lt;!-- 取 --&gt;</span><br><span class="line">var user_info = wx.getStorageSync(&quot;user_info&quot;)</span><br><span class="line">this.setData(&#123;</span><br><span class="line">username: user_info.username</span><br><span class="line">&#125;);</span><br><span class="line">&lt;!-- 删 --&gt;</span><br><span class="line">wx.removeStorageSync(&quot;user_info&quot;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>全局的app对象</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- app.js --&gt;</span><br><span class="line">//用户数据</span><br><span class="line">appData: &#123;</span><br><span class="line">    user_info:null,</span><br><span class="line">&#125;</span><br><span class="line">&lt;!-- 需要赋值的时候 --&gt;</span><br><span class="line">var app = getApp();</span><br><span class="line">app.appData.user_info = &#123;&quot;username&quot;：&quot;jane&quot;&#125;;</span><br><span class="line">&lt;!-- 需要取值的时候 --&gt;</span><br><span class="line">var app = getApp();</span><br><span class="line">var user_info = app.appData.user_info;</span><br><span class="line">this.setData(&#123;</span><br><span class="line">    username: user_info.username</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
</ul>

      
      <!-- 打赏 -->
      
    </div>
    <footer class="article-footer">
      <a data-url="http://csspark.github.io/2019/09/17/微信小程序实践之直播推流/" data-id="ck5d8fq3w001lgdgfw43myo8z" class="article-share-link">分享</a>
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/微信小程序/">微信小程序</a></li></ul>

    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-系统TPS，并发，响应时间，吞吐量评估" class="article article-type-post" itemscope="" itemprop="blogPost" data-scroll-reveal="">

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2019/08/14/系统TPS，并发，响应时间，吞吐量评估/">系统TPS，并发，响应时间，吞吐量评估</a>
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2019/08/14/系统TPS，并发，响应时间，吞吐量评估/" class="article-date">
  <time datetime="2019-08-14T06:09:39.000Z" itemprop="datePublished">2019-08-14</time>
</a>
      
      
      
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h1 id="关系"><a href="#关系" class="headerlink" title="关系"></a>关系</h1><p>系统吞吐量（Throughput）几个重要参数：QPS（TPS）、并发数、响应时间（RT）</p>
<ul>
<li>QPS（TPS）：每秒钟request/事务 数量</li>
<li>并发数： 系统同时处理的request/事务数</li>
<li>响应时间：  一般取平均响应时间</li>
</ul>
<p>并发并不等于QPS(TPS)，因为一个query(请求)或者Trransaction（事务）并非占据全部的CPU，IO等资源，对于一个多用户的系统，如果只有一个用户使用时系统的平均响应时间是t，当有你n个用户使用时，每个用户看到的响应时间通常并不是n×t，而往往比n×t小很多（当然，在某些特殊情况下也可能比n×t大，甚至大很多），在每个时间点都可能有许多资源被闲置，当处理多个请求时，如果资源配置合理，每个用户看到的平均响应时间并不随用户数的增加而线性增加，在应用场景访问压力下，只要某一项达到系统最高值，系统的吞吐量就上不去了，如果压力继续增大，系统的吞吐量反而会下降，原因是系统超负荷工作，上下文切换、内存等等其它消耗导致系统性能下降</p>
<p>一般来说关系是：<br>QPS（TPS）= 并发数/平均响应时间</p>
<h1 id="QPS"><a href="#QPS" class="headerlink" title="QPS"></a>QPS</h1><p>原理：每天80%的访问集中在20%的时间里，这20%时间叫做峰值时间。</p>
<p>公式：( 总PV数 <em> 80% ) / ( 每天秒数 </em> 20% ) = 峰值时间每秒请求数(QPS) 。</p>
<p>机器：峰值时间每秒QPS / 单台机器的QPS = 需要的机器 。</p>
<p>每天300w PV 的在单台机器上，这台机器需要多少QPS？</p>
<p>( 3000000 <em> 0.8 ) / (86400 </em> 0.2 ) = 139 (QPS)。</p>
<p>一般需要达到139QPS，因为是峰值。</p>
<p>每秒查询率QPS是对一个特定的查询服务器在规定时间内所处理流量多少的衡量标准。</p>
<p>因特网上，经常用每秒查询率来衡量域名系统服务器的机器的性能，其即为QPS。</p>
<p>对应fetches/sec，即每秒的响应请求数，也即是最大吞吐能力。</p>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p>1、<a href="https://www.cnblogs.com/longxiaojiangi/p/9259745.html" target="_blank" rel="noopener">https://www.cnblogs.com/longxiaojiangi/p/9259745.html</a></p>
<p>2、<a href="http://www.ha97.com/5095.html" target="_blank" rel="noopener">http://www.ha97.com/5095.html</a></p>

      
      <!-- 打赏 -->
      
    </div>
    <footer class="article-footer">
      <a data-url="http://csspark.github.io/2019/08/14/系统TPS，并发，响应时间，吞吐量评估/" data-id="ck5d8fq44001zgdgfa0ifqjuu" class="article-share-link">分享</a>
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/TPS-QPS-并发，RT/">TPS,QPS,并发，RT</a></li></ul>

    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-mysql造数据脚本" class="article article-type-post" itemscope="" itemprop="blogPost" data-scroll-reveal="">

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2019/08/08/mysql造数据脚本/">mysql造数据脚本</a>
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2019/08/08/mysql造数据脚本/" class="article-date">
  <time datetime="2019-08-08T01:19:41.000Z" itemprop="datePublished">2019-08-08</time>
</a>
      
      
      
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      


      

      
      <blockquote>
<p>mysql造数据脚本</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line">use stu;</span><br><span class="line">drop table if exists student;</span><br><span class="line">create table student</span><br><span class="line">  (  s_id int(11) not null auto_increment ,</span><br><span class="line">     sno    int(11),</span><br><span class="line">     sname varchar(50),</span><br><span class="line">     sage  int(11),</span><br><span class="line">     ssex  varchar(8) ,</span><br><span class="line">     father_id int(11),</span><br><span class="line">      mather_id int(11),</span><br><span class="line">      note varchar(500),</span><br><span class="line">     primary key (s_id),</span><br><span class="line">   unique key uk_sno (sno)</span><br><span class="line">  ) engine=innodb default charset=utf8mb4;</span><br><span class="line">truncate table student;</span><br><span class="line">  delimiter $$</span><br><span class="line">drop function if exists   insert_student_data $$</span><br><span class="line">create function insert_student_data()</span><br><span class="line"> returns  int deterministic</span><br><span class="line">    begin</span><br><span class="line">    declare  i int;</span><br><span class="line">      set i=1;</span><br><span class="line">      while  i&lt;50000000 do</span><br><span class="line">      insert into student  values(i ,i, concat(&apos;name&apos;,i),i,case when floor(rand()*10)%2=0 then &apos;f&apos; else &apos;m&apos; end,floor(rand()*100000),floor(rand()*1000000),concat(&apos;note&apos;,i) );</span><br><span class="line">      set i=i+1;</span><br><span class="line">      end while;</span><br><span class="line">      return 1;</span><br><span class="line">    end$$</span><br><span class="line">delimiter ;</span><br><span class="line">select  insert_student_data();</span><br><span class="line">select count(*) from student;</span><br><span class="line">use stu;</span><br><span class="line">create table course</span><br><span class="line">  (</span><br><span class="line">     c_id int(11) not null auto_increment ,</span><br><span class="line">     cname varchar(50)</span><br><span class="line">     note varchar(500), primary key (c_id)</span><br><span class="line">  )  engine=innodb default charset=utf8mb4;</span><br><span class="line">truncate table course;</span><br><span class="line">  delimiter $$</span><br><span class="line">drop function if exists   insert_course_data $$</span><br><span class="line">create function insert_course_data()</span><br><span class="line"> returns  int deterministic</span><br><span class="line">    begin</span><br><span class="line">    declare  i int;</span><br><span class="line">      set i=1;</span><br><span class="line">      while  i&lt;=1000 do</span><br><span class="line">      insert into course  values(i , concat(&apos;course&apos;,i),floor(rand()*1000),concat(&apos;note&apos;,i) );</span><br><span class="line">      set i=i+1;</span><br><span class="line">      end while;</span><br><span class="line">      return 1;</span><br><span class="line">    end$$</span><br><span class="line">delimiter ;</span><br><span class="line">select  insert_course_data();</span><br><span class="line">select count(*) from course;</span><br><span class="line">use stu;</span><br><span class="line">drop table if exists sc;</span><br><span class="line">create table sc</span><br><span class="line">  (</span><br><span class="line">     s_id    int(11),</span><br><span class="line">     c_id    int(11),</span><br><span class="line">     t_id    int(11),</span><br><span class="line">     score int(11)</span><br><span class="line">  )  engine=innodb default charset=utf8mb4;</span><br><span class="line">truncate table sc;</span><br><span class="line">  delimiter $$</span><br><span class="line">drop function if exists   insert_sc_data $$</span><br><span class="line">create function insert_sc_data()</span><br><span class="line"> returns  int deterministic</span><br><span class="line">    begin</span><br><span class="line">    declare  i int;</span><br><span class="line">      set i=1;</span><br><span class="line">      while  i&lt;=50000000 do</span><br><span class="line">      insert into sc  values( i,floor(rand()*1000),floor(rand()*10000000),floor(rand()*750)) ;</span><br><span class="line">      set i=i+1;</span><br><span class="line">      end while;</span><br><span class="line">      return 1;</span><br><span class="line">    end$$</span><br><span class="line">delimiter ;</span><br><span class="line">select  insert_sc_data();</span><br><span class="line">commit;</span><br><span class="line">select  insert_sc_data();</span><br><span class="line">commit;</span><br><span class="line">create index idx_s_id  on sc(s_id)   ;</span><br><span class="line">create index idx_t_id  on sc(t_id)   ;</span><br><span class="line">create index idx_c_id  on sc(c_id)   ;</span><br><span class="line">select count(*) from sc;</span><br><span class="line">use stu;</span><br><span class="line">drop table if exists teacher;</span><br><span class="line">create table teacher</span><br><span class="line">  (</span><br><span class="line">    t_id  int(11) not null auto_increment ,</span><br><span class="line">     tname varchar(50) ,</span><br><span class="line">     note varchar(500),primary key (t_id)</span><br><span class="line">  )  engine=innodb default charset=utf8mb4;</span><br><span class="line"></span><br><span class="line">  truncate table teacher;</span><br><span class="line">  delimiter $$</span><br><span class="line">drop function if exists   insert_teacher_data $$</span><br><span class="line">create function insert_teacher_data()</span><br><span class="line"> returns  int deterministic</span><br><span class="line">    begin</span><br><span class="line">    declare  i int;</span><br><span class="line">      set i=1;</span><br><span class="line">      while  i&lt;=10000000 do</span><br><span class="line">      insert into teacher  values(i , concat(&apos;tname&apos;,i),concat(&apos;note&apos;,i) );</span><br><span class="line">      set i=i+1;</span><br><span class="line">      end while;</span><br><span class="line">      return 1;</span><br><span class="line">    end$$</span><br><span class="line">delimiter ;</span><br><span class="line">select  insert_teacher_data();</span><br><span class="line">commit;</span><br><span class="line">select count(*) from teacher;</span><br></pre></td></tr></table></figure>
      
      <!-- 打赏 -->
      
    </div>
    <footer class="article-footer">
      <a data-url="http://csspark.github.io/2019/08/08/mysql造数据脚本/" data-id="ck5d8fq3c000lgdgfrq0uhves" class="article-share-link">分享</a>
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mysql/">mysql</a></li></ul>

    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-监控预警系统方案调研" class="article article-type-post" itemscope="" itemprop="blogPost" data-scroll-reveal="">

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2019/08/03/监控预警系统方案调研/">监控预警系统方案调研</a>
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2019/08/03/监控预警系统方案调研/" class="article-date">
  <time datetime="2019-08-03T07:41:13.000Z" itemprop="datePublished">2019-08-03</time>
</a>
      
      
      
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      


      

      
      <p>telegraf 收集数据<br>influxDB 存储数据<br>grafana 展示数据</p>
<p>这和ELK的优缺点待查</p>
<p>在展示上kibana还是不如grafana</p>
<blockquote>
<p>安装<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">安装grafana</span><br><span class="line">Grafana是一个纯html/js的web应用，是一个开源仪表盘工具，访问InfluxDB时不会存在跨域访问的限制，只要配置好数据源后，即可展示监控数据。</span><br><span class="line"> docker run \</span><br><span class="line">  -d \</span><br><span class="line">  -p 3000:3000 \</span><br><span class="line">  --name grafana \</span><br><span class="line">  grafana/grafana:5.1.0</span><br><span class="line"></span><br><span class="line">安装influxDB</span><br><span class="line">InfluxDB 是一个开源分布式时序、事件和指标数据库。使用 Go 语言编写，无需外部依赖。其设计目标是实现分布式和水平伸缩扩展。</span><br><span class="line"></span><br><span class="line">docker create -p 8083:8083 -p 8086:8086 -v /opt/influxdb:/var/lib/influxdb --name=influxdb --hostname=influxdb tutum/influxdb</span><br><span class="line"></span><br><span class="line">docker start influxdb</span><br><span class="line">打开http://******:8083/，这是influxDB的web管理界面</span><br><span class="line">新建数据库mlink</span><br><span class="line">新增用户名telegraf，密码telegraf</span><br><span class="line"></span><br><span class="line">安装telegraf</span><br><span class="line"></span><br><span class="line">Telegraf是一个用Go语言编写的代理程序，可采集系统和服务的统计数据，并写入InfluxDB数据库。Telegraf具有内存占用小的特点，通过插件系统开发人员可轻松添加支持其他服务的扩展</span><br><span class="line"></span><br><span class="line">wget https://dl.influxdata.com/telegraf/releases/telegraf-1.7.4-1.x86_64.rpm</span><br><span class="line">yum localinstall telegraf-1.7.4-1.x86_64.rpm </span><br><span class="line"></span><br><span class="line">vim /etc/telegraf/telegraf.conf</span><br><span class="line">修改如下配置项</span><br><span class="line">[[outputs.influxdb]]</span><br><span class="line">  ## The full HTTP or UDP URL for your InfluxDB instance.</span><br><span class="line">  urls = [&quot;http://127.0.0.1:8086&quot;]</span><br><span class="line"></span><br><span class="line">  ## The target database for metrics; will be created as needed.</span><br><span class="line">  database = &quot;telegraf&quot;</span><br><span class="line"></span><br><span class="line">  ## Name of existing retention policy to write to.  Empty string writes to</span><br><span class="line">  ## the default retention policy.  Only takes effect when using HTTP.</span><br><span class="line">   retention_policy = &quot;&quot;</span><br><span class="line"></span><br><span class="line">  ## Timeout for HTTP messages.</span><br><span class="line">   timeout = &quot;5s&quot;</span><br><span class="line"></span><br><span class="line">  ## HTTP Basic Auth</span><br><span class="line">  username = &quot;telegraf&quot;</span><br><span class="line">  password = &quot;telegraf&quot;</span><br><span class="line"></span><br><span class="line">systemctl start telegraf</span><br><span class="line"></span><br><span class="line">安装grafana面板</span><br><span class="line">1、在https://grafana.com/grafana/dashboards 搜索Dynamic Dashboard，复制ID，</span><br><span class="line">2、在grafana中导入dashboard即可</span><br></pre></td></tr></table></figure></p>
</blockquote>
<blockquote>
<p>预警<br>编辑监控指标设置规则即可预警</p>
</blockquote>
<p>参考链接<br><a href="https://www.jianshu.com/p/fe11d681bd58" target="_blank" rel="noopener">https://www.jianshu.com/p/fe11d681bd58</a></p>

      
      <!-- 打赏 -->
      
    </div>
    <footer class="article-footer">
      <a data-url="http://csspark.github.io/2019/08/03/监控预警系统方案调研/" data-id="ck5d8fq3z001pgdgfe1dev2xx" class="article-share-link">分享</a>
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/telegraf-influxDB-grafana/">telegraf,influxDB,grafana</a></li></ul>

    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-ios推流端修改打包上线" class="article article-type-post" itemscope="" itemprop="blogPost" data-scroll-reveal="">

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2019/07/30/ios推流端修改打包上线/">ios推流端修改打包上线</a>
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2019/07/30/ios推流端修改打包上线/" class="article-date">
  <time datetime="2019-07-30T01:38:40.000Z" itemprop="datePublished">2019-07-30</time>
</a>
      
      
      
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><p>本笔记记录将七牛的ios推流端修改定制打包上线的过程，因为平常不常用ios开发工具，特此记录。</p>
<blockquote>
<p>环境</p>
</blockquote>
<ul>
<li>xcode 9.3</li>
<li>macOS 10.14</li>
<li>code:<br><a href="https://github.com/pili-engineering/PLMediaStreamingKit.git" target="_blank" rel="noopener">https://github.com/pili-engineering/PLMediaStreamingKit.git</a></li>
</ul>
<blockquote>
<p>过程</p>
<ul>
<li>gem安装</li>
</ul>
</blockquote>
<pre><code>gem是object-c和swift的依赖包管理工具，等同与python的pip，php的conposer，node的npm等

1、 命令：sudo gem install cocospods

2、 可能问题：镜像错误，下载404
解决：
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#移除失效的</span><br><span class="line">gem sources --remove https://rubygems.org/</span><br><span class="line">#添加有效的</span><br><span class="line">gem sources -a https://gems.ruby-china.com/</span><br><span class="line">#验证</span><br><span class="line">gem sources -l</span><br><span class="line">#重新安装</span><br></pre></td></tr></table></figure>
</code></pre><ul>
<li><p>知识补充</p>
<p>  1、Certificates 开发者证书分为开发（iOS Development）和发布（iOS Distribution）两种类型。<br>  这个是最基础的，用来证明自己是开发者身份的。里面还包含推送APNS推送证书，推送证书也是分为开发和发布两种类型。</p>
<p>  2、App IDs：这是每个应用的独立标识，在设置项中可以配置该应用的权限<br>  APP id对应工程里的bundleID，唯一。比如是否用到了PassBook，GameCenter，以及更常见的push服务。如果选中了Push服务，那么就可以创建生成上面第一条所提到的推送证书。</p>
<p>  3、Devices测试机器绑定</p>
<p>  4、Provisioning Profiles：描述文件，也称为PP文件<br>  该文件将AppID、开发者证书、硬件Device绑定到一块儿，在开发者中心配置好后可以添加到Xcode上，也可以直接在Xcode上连接开发者中心生成。真机调试时需要在PP文件中添加真记得udid<br>  <a href="http://www.cocoachina.com/cms/wap.php?action=article&amp;id=25809" target="_blank" rel="noopener">http://www.cocoachina.com/cms/wap.php?action=article&amp;id=25809</a></p>
</li>
</ul>

      
      <!-- 打赏 -->
      
    </div>
    <footer class="article-footer">
      <a data-url="http://csspark.github.io/2019/07/30/ios推流端修改打包上线/" data-id="ck5d8fq3g000tgdgfahdu3gpa" class="article-share-link">分享</a>
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ios/">ios</a></li></ul>

    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-开源ELK统一日志平台实践" class="article article-type-post" itemscope="" itemprop="blogPost" data-scroll-reveal="">

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2019/07/02/开源ELK统一日志平台实践/">开源ELK统一日志平台实践</a>
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2019/07/02/开源ELK统一日志平台实践/" class="article-date">
  <time datetime="2019-07-02T01:21:00.000Z" itemprop="datePublished">2019-07-02</time>
</a>
      
      
      
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h1 id="ELK开源统一日志系统实践"><a href="#ELK开源统一日志系统实践" class="headerlink" title="ELK开源统一日志系统实践"></a>ELK开源统一日志系统实践</h1><h2 id="编译安装"><a href="#编译安装" class="headerlink" title="编译安装"></a>编译安装</h2><h3 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h3><p>10.10.10.245 filebeat+nginx</p>
<p>10.10.10.15 elasticsearch</p>
<p>10.10.10.10 logstash<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">1、下载安装包</span><br><span class="line"></span><br><span class="line">wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-7.2.0-linux-x86_64.tar.gz</span><br><span class="line">wget https://artifacts.elastic.co/downloads/kibana/kibana-7.2.0-linux-x86_64.tar.gz</span><br><span class="line">wget https://artifacts.elastic.co/downloads/logstash/logstash-7.2.0.tar.gz</span><br><span class="line">wget https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-7.2.0-linux-x86_64.tar.gz</span><br><span class="line"></span><br><span class="line">2、解压</span><br><span class="line"></span><br><span class="line">tar zxvf ***</span><br><span class="line"></span><br><span class="line">3、新建用户组</span><br><span class="line"></span><br><span class="line">groupadd elasticsearch</span><br><span class="line">useradd elasticsearch -g elasticsearch</span><br><span class="line"></span><br><span class="line">mkdir /elk</span><br><span class="line"></span><br><span class="line">mv **解压文件 /elk</span><br><span class="line"></span><br><span class="line">chown -R elasticsearch.elasticsearch /elk</span><br><span class="line"></span><br><span class="line">su elasticsearch</span><br><span class="line"></span><br><span class="line">4、启动Elasticsearch</span><br><span class="line"></span><br><span class="line">nohup /elk/elasticsearch-7.2.0/bin/elasticsearch -d &gt; /elk/runlog/elasticsearch.log 2&gt;&amp;1 &amp;</span><br><span class="line"></span><br><span class="line">5、配置logstash </span><br><span class="line"></span><br><span class="line">vi logstash-nginx-es.conf</span><br><span class="line"></span><br><span class="line">input &#123;</span><br><span class="line">    beats &#123;</span><br><span class="line">        host =&gt; &quot;0.0.0.0&quot;</span><br><span class="line">        port =&gt; 5400</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">filter &#123;</span><br><span class="line">   grok &#123;</span><br><span class="line">      match =&gt; &#123; &quot;message&quot; =&gt; &quot;%&#123;IPORHOST:remote_ip&#125; - %&#123;DATA:user_name&#125; \[%&#123;HTTPDATE:access_time&#125;\] \&quot;%&#123;WORD:http_method&#125; %&#123;DATA:url&#125; HTTP/%&#123;NUMBER:http_version&#125;\&quot; %&#123;NUMBER:response_code&#125; %&#123;NUMBER:body_sent_bytes&#125; \&quot;%&#123;DATA:referrer&#125;\&quot; \&quot;%&#123;DATA:agent&#125;\&quot;&quot; &#125;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output &#123;</span><br><span class="line"> elasticsearch &#123;</span><br><span class="line">   hosts =&gt; [&quot;124.232.150.15:9200&quot;]</span><br><span class="line">   index =&gt; &quot;nginx_index_pattern-%&#123;+YYYY.MM.dd&#125;&quot;    #这个weblogs_index_pattern就是kibana里面的index_pattern,可以改成自定义的名字</span><br><span class="line"> &#125;</span><br><span class="line"> stdout &#123; codec =&gt; rubydebug &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">nohup /usr/local/src/logstash-7.2.0/bin/logstash -f </span><br><span class="line">/usr/local/src/logstash-7.2.0/config/nginx_log.conf&gt;/usr/local/src/runlog/logstash.log 2&gt;&amp;1 &amp;</span><br><span class="line"></span><br><span class="line">6、配置并启动kibana</span><br><span class="line">server.port: 5601</span><br><span class="line">server.host: &quot;0.0.0.0&quot;</span><br><span class="line">elasticsearch.hosts: [&quot;http://124.232.150.15:9200&quot;]</span><br><span class="line">pid.file: /elk/kibana-7.2/kibana.pid</span><br><span class="line"></span><br><span class="line">nohup /elk/kibana-7.2/bin/kibana &gt; /elk/runlog/kibana.log 2&gt;&amp;1 &amp;</span><br><span class="line"></span><br><span class="line">7、配置收集器filebeat</span><br><span class="line">vim filebeat.yml</span><br><span class="line"></span><br><span class="line">filebeat.inputs:</span><br><span class="line">- type: log</span><br><span class="line">    enabled: true</span><br><span class="line">    paths:</span><br><span class="line">        - /home/data/nginx_log/*.log</span><br><span class="line"></span><br><span class="line">output.logstash:</span><br><span class="line">    hosts: [&quot;124.232.150.10:5400&quot;]</span><br><span class="line"></span><br><span class="line">nohup /usr/local/src/filebeat-7.2/filebeat -e -c /usr/local/src/filebeat-7.2/filebeat.yml &gt;/usr/local/src/filebeat-7.2/filebeat-7.2/filebeat.log &amp;</span><br></pre></td></tr></table></figure></p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a href="https://www.codercto.com/a/36757.html" target="_blank" rel="noopener">配置kibana dashboard</a></p>
<p><a href="https://www.codercto.com/a/37248.html" target="_blank" rel="noopener">logstash Grok配置</a></p>
<h2 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h2><ul>
<li>自定义数据类型展示在kibana的面板上</li>
<li>kibana与grafana的对比和选择</li>
</ul>

      
      <!-- 打赏 -->
      
    </div>
    <footer class="article-footer">
      <a data-url="http://csspark.github.io/2019/07/02/开源ELK统一日志平台实践/" data-id="ck5d8fq3u001hgdgf7vrw4wez" class="article-share-link">分享</a>
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ELK-日志/">ELK 日志</a></li></ul>

    </footer>

  </div>

  

  
  
  

  

</article>
    
  </article>
  

  
  <nav class="page-nav">
    
    <a class="extend prev" rel="prev" href="/">上一页</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/3/">下一页</a>
  </nav>
  
</section>
</div>

      <footer class="footer">
  <div class="outer">
    <ul class="list-inline">
      <li>
        &copy;
        2015-2020
        Spark
      </li>
      <li>
        
          Powered by
        
        
        <a href="https://hexo.io" target="_blank">Hexo</a> Theme <a href="https://github.com/Shen-Yu/hexo-theme-ayer" target="_blank">Ayer</a>
        
      </li>
    </ul>
    <ul class="list-inline">
      <li>
        
        
        <ul class="list-inline">
  <li>PV:<span id="busuanzi_value_page_pv"></span></li>
  <li>UV:<span id="busuanzi_value_site_uv"></span></li>
</ul>
        
      </li>
      <li>
        <!-- cnzz统计 -->
        
        <script type="text/javascript" src="https://s9.cnzz.com/z_stat.php?id=1278069914&amp;web_id=1278069914"></script>
        
      </li>
    </ul>
  </div>
</footer>
    <div class="to_top">
        <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>
      </div>
    </main>
    
      <aside class="sidebar">
        
        <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/ayer-side.svg" alt="Spark的博客"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">目录</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">标签</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags/旅行/">旅行</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="http://shenyu-vip.lofter.com">摄影</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/2019/about">关于我</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search" title="搜索">
        <i class="ri-search-line"></i>
      </a>
      
      
      <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
        <i class="ri-rss-line"></i>
      </a>
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
      </aside>
      <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>请我喝杯咖啡吧~</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="/images/alipay.jpg">
      <span class="reward-type">支付宝</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="/images/wechat.jpg">
      <span class="reward-type">微信</span>
    </div>
    
  </div>
</div>
      <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.justifiedGallery.min.js"></script>
<script src="/js/lazyload.min.js"></script>
<script src="/js/busuanzi-2.3.pure.min.js"></script>

  <script src="/fancybox/jquery.fancybox.min.js"></script>




<script>
  var ayerConfig = {
    mathjax: false
  }
</script>

<script src="/js/ayer.js"></script>

<script src="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.css">



<script type="text/javascript" src="https://js.users.51.la/20544303.js"></script>
  
  

  </div>
</body>

</html>