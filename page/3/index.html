<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
   
  <meta name="keywords" content="IT，Life" />
   
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>
     Spark的博客
  </title>
  <meta name="generator" content="hexo-theme-yilia-plus">
  
  <link rel="shortcut icon" href="/favicon.ico" />
  
  <link rel="stylesheet" href="/css/style.css">
  <script src="/js/pace.min.js"></script>

  

  

</head>

</html>

<body>
  <div id="app">
    <main class="content">
      
<section class="cover">
    
      
      <a class="forkMe" href="https://github.com/Shen-Yu/hexo-theme-ayer" target="_blank"><img width="149" height="149" src="/images/forkme.png" class="attachment-full size-full" alt="Fork me on GitHub" data-recalc-dims="1"></a>
    
  <div class="cover-frame">
    <div class="bg-box">
      <img src="/images/cover1.jpg" alt="image frame">
    </div>
    <div class="cover-inner text-center text-white">
      <h1><a href="/">Spark的博客</a></h1>
      <h2>一生挨踢，永远学习，坚守信仰，简单活着</h2>
      <div>
        
      </div>
    </div>
  </div>
  <div class="cover-learn-more">
    <a href="javascript:void(0)" class="anchor"><i class="ri-arrow-down-line"></i></a>
  </div>
</section>

<div id="main">
  <section class="outer">
  <article class="articles">
    
    
    
    
    <article id="post-面试题" class="article article-type-post" itemscope="" itemprop="blogPost" data-scroll-reveal="">

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2019/06/05/面试题/">面试题</a>
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2019/06/05/面试题/" class="article-date">
  <time datetime="2019-06-05T02:16:05.000Z" itemprop="datePublished">2019-06-05</time>
</a>
      
      
      
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h1 id="运维"><a href="#运维" class="headerlink" title="运维"></a>运维</h1><p>环境：24核2.0Ghz，32G，1T，nginx+php-fpm+mysql单台部署<br>表现是页面出现排队现象，有时能进有时不能进。cpu load average: 5.84, 5.96, 5.06<br>请问排查思路和解决办法？<br>排队现象极有可能是有些进程缓慢导致堵塞，文件句柄到达极限引起，CPU资源，内存资源紧张。</p>
<p>linux内核+tcp连接优化<br>php-fpm结合日志优化<br>mysql慢日志查询<br>nginx日志</p>
<h1 id="网络基础"><a href="#网络基础" class="headerlink" title="网络基础"></a>网络基础</h1><p>tcp协议<br>进程<br>tcp<br>socket<br>fd</p>
<p>每个tcp连接都对应一对socket，返回的socket是一个fd</p>
<p>多个http请求因为http1.1之后支持持久连接，可以多个请求共用一个连接</p>
<p>i/o模型【多路复用/异步/阻塞/非阻塞】<br>select，poll/epoll<br><a href="https://www.jianshu.com/p/397449cadc9a" target="_blank" rel="noopener">https://www.jianshu.com/p/397449cadc9a</a><br>        select    poll    epoll<br>实现方式 array      链表    hash表</p>
<p>http请求</p>
<p>CPU  内存  网络带宽资源</p>

      
      <!-- 打赏 -->
      
    </div>
    <footer class="article-footer">
      <a data-url="http://csspark.github.io/2019/06/05/面试题/" data-id="ck5d8fq460023gdgfexfpozwl" class="article-share-link">分享</a>
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/面试/">面试</a></li></ul>

    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-wireguard实践" class="article article-type-post" itemscope="" itemprop="blogPost" data-scroll-reveal="">

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2019/06/04/wireguard实践/">wireguard实践</a>
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2019/06/04/wireguard实践/" class="article-date">
  <time datetime="2019-06-04T06:19:30.000Z" itemprop="datePublished">2019-06-04</time>
</a>
      
      
      
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      


      

      
      <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//https://github.com/l-n-s/wireguard-install.git</span><br><span class="line"></span><br><span class="line">wget https://raw.githubusercontent.com/l-n-s/wireguard-install/master/wireguard-install.sh -O wireguard-install.sh</span><br><span class="line">bash wireguard-install.sh</span><br></pre></td></tr></table></figure>
      
      <!-- 打赏 -->
      
    </div>
    <footer class="article-footer">
      <a data-url="http://csspark.github.io/2019/06/04/wireguard实践/" data-id="ck5d8fq3p0019gdgfjdacyx3x" class="article-share-link">分享</a>
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/wireguard-vpn/">wireguard,vpn</a></li></ul>

    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-mqtt系列上手实践" class="article article-type-post" itemscope="" itemprop="blogPost" data-scroll-reveal="">

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2019/05/16/mqtt系列上手实践/">mqtt系列上手实践</a>
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2019/05/16/mqtt系列上手实践/" class="article-date">
  <time datetime="2019-05-16T03:12:51.000Z" itemprop="datePublished">2019-05-16</time>
</a>
      
      
      
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><pre><code>MQTT 全称为 Message Queuing Telemetry Transport（消息队列遥测传输）是一种基于发布/订阅范式的“轻量级”消息协议，由 IBM 发布。

MQTT 可以被解释为一种低开销，低带宽占用的即时通讯协议，可以用极少的代码和带宽的为连接远程设备提供实时可靠的消息服务，它适用于硬件性能低下的远程设备以及网络状况糟糕的环境下，因此 MQTT 协议在 IoT（Internet of things，物联网），小型设备应用，移动应用等方面有较广泛的应用。

IoT 设备要运作，就必须连接到互联网，设备才能相互协作，以及与后端服务协同工作。而互联网的基础网络协议是 TCP/IP，MQTT 协议是基于 TCP/IP 协议栈而构建的，因此它已经慢慢的已经成为了 IoT 通讯的标准。

协议中主要有三种身份：发布者（Publisher）、代理（Broker，服务器）、订阅者（Subscriber）。其中，消息的发布者和订阅者都是客户端，消息代理是服务器，而消息发布者可以同时是订阅者，实现了生产者与消费者的脱耦。

协议有三种消息发布的服务质量：
    至多一次，消息发布完全依赖底层 TCP/IP 网络。会发生消息丢失或重复。这一级别可用于如下情况，环境传感器数据，丢失一次读记录无所谓，因为不久后还会有第二次发送。

    至少一次，确保消息到达，但消息重复可能会发生。

    只有一次，确保消息到达一次。这一级别可用于如下情况，在计费系统中，消息重复或丢失会导致不正确的结果。
</code></pre><h1 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h1><ul>
<li>MQTT 客户端<br>  一个使用 MQTT 协议的设备、应用程序等，它总是建立到服务器的网络连接。<br>  1、可以发布信息，其他客户端可以订阅该信息<br>  2、订阅其它客户端发布的消息<br>  3、退订或删除应用程序的消息<br>  4、断开与服务器连接</li>
<li>MQTT 服务器<br>  MQTT 服务器以称为 Broker（消息代理），以是一个应用程序或一台设备。它是位于消息发布者 和订阅者之间<br>  1、接受来自客户端的网络连接<br>  2、接受客户端发布的应用信息<br>  3、处理来自客户端的订阅和退订请求<br>  4、向订阅的客户转发应用程序消息</li>
<li>主题（Topic）<br>  连接到一个应用程序消息的标签，该标签与服务器的订阅相匹配。服务器会将消息发送给订阅所匹配标签的每个客户端。<br>  1、要订阅的主题。一个主题可以有多个级别，级别之间用斜杠字符分隔。例如，/world 和 emq/emqtt/emqx 是有效的主题。<br>  2、订阅者的Topic name支持通配符#和+ ：<pre><code># 支持一个主题内任意级别话题
+只匹配一个主题级别的通配符
</code></pre>  3、客户端成功订阅某个主题后，代理会返回一条 SUBACK 消息，其中包含一个或多个 returnCode 参数</li>
<li>QoS（消息传递的服务质量水平）<br>  服务质量，标志表明此主题范围内的消息传送到客户端所需的一致程度。<br>  1、值 0：不可靠，消息基本上仅传送一次，如果当时客户端不可用，则会丢失该消息。<br>  2、值 1：消息应传送至少 1 次。<br>  3、值 2：消息仅传送一次。</li>
<li>订阅（Subscription）<br>  订阅包含主题筛选器（Topic Filter）和最大服务质量（QoS）。订阅会与一个会话（Session）关联。一个会话可以包含多个订阅。每一个会话中的每个订阅都有一个不同的主题筛选器。<br>  1、客户端在成功建立TCP连接之后，发送CONNECT消息，在得到服务器端授权允许建立彼此连接的CONNACK消息之后，客户端会发送SUBSCRIBE消息，订阅感兴趣的Topic主题列表（至少一个主题）<br>  2、订阅的主题名称采用UTF-8编码，然后紧跟着对应的QoS值</li>
<li>发布（publish）<br>  控制报文是指从客户端向服务端或者服务端向客户端传输一个应用消息，MQTT 客户端发送消息请求，发送完成后返回应用程序线程<br>  比如安卓的推送服务，还有一些即时通信软件如微信等也是采用的推送技术。</li>
</ul>
<p><a href="https://www.jianshu.com/p/ecde412d2eeb" target="_blank" rel="noopener">参考资料</a></p>
<h1 id="mosiquitto"><a href="#mosiquitto" class="headerlink" title="mosiquitto"></a>mosiquitto</h1>
      
      <!-- 打赏 -->
      
    </div>
    <footer class="article-footer">
      <a data-url="http://csspark.github.io/2019/05/16/mqtt系列上手实践/" data-id="ck5d8fq3b000igdgf2m7qam8p" class="article-share-link">分享</a>
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MQTT-Mosquitto-rabbitMQ/">MQTT,Mosquitto,rabbitMQ</a></li></ul>

    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-raspberry上手实践" class="article article-type-post" itemscope="" itemprop="blogPost" data-scroll-reveal="">

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2019/04/29/raspberry上手实践/">raspberry树莓派上手实践</a>
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2019/04/29/raspberry上手实践/" class="article-date">
  <time datetime="2019-04-29T07:52:07.000Z" itemprop="datePublished">2019-04-29</time>
</a>
      
      
      
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h1 id="树莓派智能家居实践"><a href="#树莓派智能家居实践" class="headerlink" title="树莓派智能家居实践"></a>树莓派智能家居实践</h1><p>Mac环境下：</p>
<ul>
<li><p>刷入系统</p>
<blockquote>
<p><a href="https://www.balena.io/etcher/" target="_blank" rel="noopener">balenaEtcher-1.5.24</a></p>
</blockquote>
<blockquote>
<p><a href="http://downloads.raspberrypi.org/raspbian_latest" target="_blank" rel="noopener">Raspbian</a></p>
</blockquote>
</li>
<li><p>开启root账号</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/ssh/sshd_config</span><br><span class="line">PermitRootLogin yes</span><br></pre></td></tr></table></figure>
</li>
<li><p>添加swap</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/dphys-swapfile</span><br><span class="line">设置CONF_SWAPSIZE为2000</span><br><span class="line">/etc/init.d/dphys-swapfile restart</span><br></pre></td></tr></table></figure>
</li>
<li><p>远程<br>  由于没有桌面服务，就算开机也不能进入系统来操作，如果有网线的话直接把网线插入树莓派即可联网，如果没有网线，只有 wifi 的话，就需要设置 wifi 的网络配置。</p>
<p>  其实操作方法是很简单的：只要将刷好 Raspbian 系统的 SD 卡用电脑读取。在 boot 分区，也就是树莓派的 /boot 目录下新建 wpa_supplicant.conf 文件，按照下面的参考格式填入内容并保存到 wpa_supplicant.conf 文件即可。</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">country=CN</span><br><span class="line">ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev</span><br><span class="line">update_config=1</span><br><span class="line"></span><br><span class="line">network=&#123;</span><br><span class="line">ssid=&quot;WiFi1&quot;</span><br><span class="line">psk=&quot;12345678&quot;</span><br><span class="line">key_mgmt=WPA-PSK</span><br><span class="line">priority=1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">network=&#123;</span><br><span class="line">ssid=&quot;WiFi-2&quot;</span><br><span class="line">psk=&quot;12345678&quot;</span><br><span class="line">key_mgmt=WPA-PSK</span><br><span class="line">priority=2</span><br><span class="line">scan_ssid=1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>  说明以及不同安全性的 WiFi 配置示例：</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">ssid:网络的ssid</span><br><span class="line">psk:wifi的密码</span><br><span class="line">priority:连接优先级，数字越大优先级越高（不可以是负数）</span><br><span class="line">scan_ssid:连接隐藏WiFi时需要指定该值为1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">如果您的 WiFi 没有密码</span><br><span class="line">network=&#123;</span><br><span class="line">ssid=&quot;你的无线网络名称（ssid）&quot;</span><br><span class="line">key_mgmt=NONE</span><br><span class="line">&#125;</span><br><span class="line">如果您的 WiFi 使用WEP加密</span><br><span class="line">network=&#123;</span><br><span class="line">ssid=&quot;你的无线网络名称（ssid）&quot;</span><br><span class="line">key_mgmt=NONE</span><br><span class="line">wep_key0=&quot;你的wifi密码&quot;</span><br><span class="line">&#125;</span><br><span class="line">如果您的 WiFi 使用WPA/WPA2加密</span><br><span class="line">network=&#123;</span><br><span class="line">ssid=&quot;你的无线网络名称（ssid）&quot;</span><br><span class="line">key_mgmt=WPA-PSK</span><br><span class="line">psk=&quot;你的wifi密码&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>  开机+联网之后找到对应的IP，ssh连接上树莓派，注意没有ssh服务的话在SD卡根目录touch ssh。初始登录用户密码：pi/raspberry</p>
<blockquote>
<p><a href="https://www.cnblogs.com/softidea/p/3761984.html" target="_blank" rel="noopener">VNC</a> </p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sudi -i</span><br><span class="line"></span><br><span class="line">apt-get install xrdp</span><br><span class="line">apt-get install tightvncserver</span><br><span class="line"></span><br><span class="line">vncserver :1 -geometry 800x600</span><br><span class="line"></span><br><span class="line">默认端口一般是5901</span><br><span class="line">具体可以在/root/.vnc下的日志中查看</span><br></pre></td></tr></table></figure>
</blockquote>
<p>  mac端安装VNC client，我选择chrome插件，可以多种选择，在<a href="https://www.realvnc.com/en/connect/download/viewer/" target="_blank" rel="noopener">这里</a>下载。</p>
<h1 id="frp-内网穿透"><a href="#frp-内网穿透" class="headerlink" title="frp 内网穿透"></a>frp 内网穿透</h1><p>  wget <a href="https://github.com/fatedier/frp/releases/download/v0.27.0/frp_0.27.0_linux_arm.tar.gz" target="_blank" rel="noopener">https://github.com/fatedier/frp/releases/download/v0.27.0/frp_0.27.0_linux_arm.tar.gz</a><br>  tar zxvf frp<strong><em><br>  mv frp</em></strong> /usr/local/frp<br>  vi frpc.ini<br>  ……</p>
</li>
<li><p>更改软件源</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># 1、修改树莓派Raspbian 系统源,注释原有的，添加中科大的</span><br><span class="line">vim /etc/apt/sources.list</span><br><span class="line"></span><br><span class="line">deb http://mirrors.ustc.edu.cn/raspbian/raspbian/ stretch main contrib non-free rpi </span><br><span class="line"></span><br><span class="line"># 2、修改debian软件源</span><br><span class="line">vim /etc/apt/sources.list.d/raspi.list</span><br><span class="line"></span><br><span class="line">deb http://mirrors.ustc.edu.cn/archive.raspberrypi.org/debian/ stretch main ui</span><br><span class="line"></span><br><span class="line"># 3、更改pip的国内的源</span><br><span class="line">vi /etc/pip.conf</span><br><span class="line"># 重新写入</span><br><span class="line">[global]</span><br><span class="line">index-url = https://pypi.mirrors.ustc.edu.cn/simple/</span><br><span class="line"></span><br><span class="line">[install]</span><br><span class="line">trusted-host = pypi.mirrors.ustc.edu.cn</span><br><span class="line"></span><br><span class="line">apt-get update</span><br></pre></td></tr></table></figure>
</li>
<li><p>安装docker</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">curl -fsSL https://get.docker.com -o get-docker.sh</span><br><span class="line">sudo sh get-docker.sh</span><br><span class="line"></span><br><span class="line">apt-get install -y apt-transport-https</span><br><span class="line">apt-get install docker-compose</span><br></pre></td></tr></table></figure>
</li>
<li><p>安装Home Assistant</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">    #升级python3.5以上版本[参考](http://blog.lxx1.com/3214)</span><br><span class="line">    apt-get install build-essential libsqlite3-dev sqlite3 bzip2 libbz2-dev</span><br><span class="line">    wget https://www.python.org/ftp/python/3.6.1/Python-3.6.1.tgz</span><br><span class="line">    tar zxvf Python-3.6.1.tgz</span><br><span class="line">    cd Python-3.6.1</span><br><span class="line">    ./configure &amp;&amp; sudo make &amp;&amp; sudo make install</span><br><span class="line">    which python</span><br><span class="line">    which python3</span><br><span class="line"></span><br><span class="line">    mv /usr/bin/python /usr/bin/python2.7.13</span><br><span class="line">    ln -s /usr/local/bin/python3 /usr/bin/python</span><br><span class="line"></span><br><span class="line">    # 安装HA</span><br><span class="line">    docker pull homeassistant/raspberrypi3-homeassistant</span><br><span class="line">    docker run -d --name=&quot;home-assistant&quot; -v /config:/config -v /etc/localtime:/etc/localtime:ro --net=host homeassistant/raspberrypi3-homeassistant</span><br><span class="line"></span><br><span class="line">    http://ip:8123</span><br><span class="line"></span><br><span class="line">    #安装hass.io</span><br><span class="line">    </span><br><span class="line">    [github](https://github.com/home-assistant/hassio-installer)</span><br><span class="line">    </span><br><span class="line">    curl -sL https://raw.githubusercontent.com/home-assistant/hassio-installer/master/hassio_install.sh | bash -s -- -m raspberrypi3</span><br><span class="line"></span><br><span class="line">* DIY zigbee 网关</span><br><span class="line">    </span><br><span class="line">    [参考](https://gadget-freakz.com/diy-zigbee-gateway/)</span><br></pre></td></tr></table></figure>
<p>  ls -l /dev/ttyACM0<br>  apt-get install autoconf automake libtool -y<br>  apt-get install libusb-1.0, libboost-all-dev -y<br>  git clone <a href="https://github.com/dashesy/cc-tool.git" target="_blank" rel="noopener">https://github.com/dashesy/cc-tool.git</a><br>  cd cc-tool<br>  ./bootstrap<br>  ./configure<br>  make<br>  –Download the firmware<br>  wget <a href="https://raw.githubusercontent.com/Koenkk/Z-Stack-firmware/master/coordinator/CC2531/bin/CC2531ZNP-Prod.hex" target="_blank" rel="noopener">https://raw.githubusercontent.com/Koenkk/Z-Stack-firmware/master/coordinator/CC2531/bin/CC2531ZNP-Prod.hex</a><br>  –or:<br>  curl <a href="https://raw.githubusercontent.com/Koenkk/Z-Stack-firmware/master/coordinator/CC2531/bin/CC2531ZNP-Prod.hex" target="_blank" rel="noopener">https://raw.githubusercontent.com/Koenkk/Z-Stack-firmware/master/coordinator/CC2531/bin/CC2531ZNP-Prod.hex</a> -o CC2531ZNP-Prod.hexsudo ./cc-tool -e -w CC2531ZNP-Prod.hex</p>
<p>  #install nodejs<br>  curl -sL <a href="https://deb.nodesource.com/setup_12.x" target="_blank" rel="noopener">https://deb.nodesource.com/setup_12.x</a> | sudo -E bash -<br>  apt-get install -y nodejs git make g++ gcc</p>
<p>  git clone <a href="https://github.com/Koenkk/zigbee2mqtt.git" target="_blank" rel="noopener">https://github.com/Koenkk/zigbee2mqtt.git</a> /opt/zigbee2mqtt<br>  cd /opt/zigbee2mqtt<br>  npm install</p>
<p>  #搭建emqx做mqtt broker</p>
</li>
</ul>
<pre><code>此处未完待续
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* 手机当摄像头监控</span><br></pre></td></tr></table></figure>

android_ip_webcam:
- host: 192.168.8.100
    name: spark camera
    username: admin
    password: spark0524
    sensors:
    - audio_connections
    - video_connections
    - battery_level
    - battery_temp
    - light
    - motion
    - pressure
    switches:
    - exposure_lock
    - ffc
    - focus
    - gps_active
    - night_vision
    - overlay
    - torch
    - whitebalance_lock
    - video_recording
    motion_sensor: TRUE
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* wifi设备接入 [参考](https://bbs.hassbian.com/thread-5500-1-1.html)</span><br><span class="line">    </span><br><span class="line">    1、打开米家ios app,配置好智能设备</span><br><span class="line"></span><br><span class="line">    2、手机连接itunes，无加密备份</span><br><span class="line">    </span><br><span class="line">    3、下载安装ibackup viewer，并打开上面的备份数据</span><br><span class="line">    </span><br><span class="line">    4、找到com.xiaomi.mihome下的文件中有一个******_mihome.sqlite，拷贝出来</span><br><span class="line">    </span><br><span class="line">    5、预备一个python3.5以上的版本环境，系统安装sqlite-devel</span><br><span class="line">    </span><br><span class="line">    6、pip3 install python-miio，小米wifi设备使用miio 协议</span><br><span class="line">    </span><br><span class="line">    7、miio-extract-tokens --dump-all  ******_mihome.sqlite即可获得token</span><br><span class="line"></span><br><span class="line">    yeelight灯需要的是ip以及结合yeelight app中的设置局域网控制开启</span><br></pre></td></tr></table></figure>

devices:
  192.168.0.109:
    name: Living Room
    transition: 1000
~~~
</code></pre>
      
      <!-- 打赏 -->
      
    </div>
    <footer class="article-footer">
      <a data-url="http://csspark.github.io/2019/04/29/raspberry上手实践/" data-id="ck5d8fq3l0010gdgfvvsyruu3" class="article-share-link">分享</a>
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/树莓派-raspberry/">树莓派,raspberry</a></li></ul>

    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-docke搭建ftpd" class="article article-type-post" itemscope="" itemprop="blogPost" data-scroll-reveal="">

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2019/04/29/docke搭建ftpd/">docker搭建ftp</a>
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2019/04/29/docke搭建ftpd/" class="article-date">
  <time datetime="2019-04-29T07:32:12.000Z" itemprop="datePublished">2019-04-29</time>
</a>
      
      
      
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h1 id="搭建记录"><a href="#搭建记录" class="headerlink" title="搭建记录"></a>搭建记录</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">docker pull stilliard/pure-ftpd:hardened</span><br><span class="line"></span><br><span class="line">docker run --rm -d --name ftpd_server -p 21:21 -p 30000-30009:30000-30009 -v /usr/local/src/pure_ftp:/pure_ftp stilliard/pure-ftpd:hardened bash /run.sh -c 30 -C 10 -l puredb:/etc/pure-ftpd/pureftpd.pdb -E -j -R -P localhost -p 30000:30059</span><br><span class="line"></span><br><span class="line">docker run -d --name ftpd_server -p 21:21 -v /usr/local/src/pure_ftp:/pure_ftp -v /config:/pure_ftp/config -e &quot;PUBLICHOST=localhost&quot; stilliard/pure-ftpd:hardened</span><br><span class="line"></span><br><span class="line">docker exec -it ftpd_server bash</span><br><span class="line"></span><br><span class="line">groupadd ftpgroup</span><br><span class="line">useradd ftpuser -g ftpgroup -d /pure_ftp -s /sbin/nologin</span><br><span class="line"></span><br><span class="line">pure-pw useradd spark -u ftpuser -g ftpgroup -d /pure_ftp</span><br><span class="line"></span><br><span class="line">pure-pw mkdb</span><br><span class="line"></span><br><span class="line">/etc/init.d/pure-ftpd restart</span><br></pre></td></tr></table></figure>
      
      <!-- 打赏 -->
      
    </div>
    <footer class="article-footer">
      <a data-url="http://csspark.github.io/2019/04/29/docke搭建ftpd/" data-id="ck5d8fq310009gdgffhy2pw89" class="article-share-link">分享</a>
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/pure-ftpd/">pure_ftpd</a></li></ul>

    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-百度网盘限制解除" class="article article-type-post" itemscope="" itemprop="blogPost" data-scroll-reveal="">

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2019/04/28/百度网盘限制解除/">百度网盘限制解除</a>
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2019/04/28/百度网盘限制解除/" class="article-date">
  <time datetime="2019-04-28T13:55:23.000Z" itemprop="datePublished">2019-04-28</time>
</a>
      
      
      
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h2 id="百度网盘限制解除"><a href="#百度网盘限制解除" class="headerlink" title="百度网盘限制解除"></a>百度网盘限制解除</h2><ul>
<li>本地安装aria2 client: Aria2GUI-v1.4.1.zip</li>
<li>安装谷歌浏览器插件<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/acgotaku/BaiduExporter.git</span><br><span class="line"></span><br><span class="line">check Developer mode -&gt; Load unpacked extension, navigate to the chrome/release folder</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>打开aria2 client，再在chrome浏览器中打开百度网盘文件页面，自动会有插件解析出下载地址，client自动下载</p>

      
      <!-- 打赏 -->
      
    </div>
    <footer class="article-footer">
      <a data-url="http://csspark.github.io/2019/04/28/百度网盘限制解除/" data-id="ck5d8fq3v001jgdgf7skmgpkh" class="article-share-link">分享</a>
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/百度网盘/">百度网盘</a></li></ul>

    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-php项目容器化" class="article article-type-post" itemscope="" itemprop="blogPost" data-scroll-reveal="">

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2019/04/19/php项目容器化/">php项目容器化</a>
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2019/04/19/php项目容器化/" class="article-date">
  <time datetime="2019-04-19T08:45:54.000Z" itemprop="datePublished">2019-04-19</time>
</a>
      
      
      
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><pre><code>一些公司php小项目，需要方便快速构建部署，期望能在一台空白的机器上，直接使用docker-compose即可部署
</code></pre><h2 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h2><h3 id="搭建registry-harbor"><a href="#搭建registry-harbor" class="headerlink" title="搭建registry harbor"></a>搭建registry harbor</h3><pre><code>网上和本地笔记都有，不多说
</code></pre><h3 id="build-images"><a href="#build-images" class="headerlink" title="build images"></a>build images</h3>
      
      <!-- 打赏 -->
      
    </div>
    <footer class="article-footer">
      <a data-url="http://csspark.github.io/2019/04/19/php项目容器化/" data-id="ck5d8fq3o0016gdgfxaaksjzl" class="article-share-link">分享</a>
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/php-docker/">php,docker</a></li></ul>

    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-mysql索引认知" class="article article-type-post" itemscope="" itemprop="blogPost" data-scroll-reveal="">

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2019/04/17/mysql索引认知/">mysql索引认知</a>
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2019/04/17/mysql索引认知/" class="article-date">
  <time datetime="2019-04-17T06:23:20.000Z" itemprop="datePublished">2019-04-17</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/mysql/">mysql</a> / <a class="article-category-link" href="/categories/mysql/db/">db</a>
  </div>

      
      
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h2 id="mysql索引认知历程"><a href="#mysql索引认知历程" class="headerlink" title="mysql索引认知历程"></a>mysql索引认知历程</h2><ul>
<li>mysql索引是一个有助于数据查询而冗余出来的一个数据结构</li>
<li>数据结构演变</li>
</ul>
<p>1、二叉查找树<br>    I/O次数多<br>    节点空间浪费<br>2、多路平衡查找树<br>    页（数据块）中存储的是关键字，行数据，子节点引用<br>3、多路平衡查找树（plus）<br>    页中存储的是关键字，子节点引用，注意没有数据区，数据全在叶子节点，叶子节点天然有序，所以排序能力，扫库扫表能力更强,子树的关键字是n，而b树是n-1个。</p>
<ul>
<li>存储引擎</li>
</ul>
<p>1、myisam<br>myi文件是索引，叶子节点保存的是一个引用，指向myd文件，主键索引和辅助索引都是在一个文件中，没有特别区分。</p>
<p>2、innodb<br>索引和数据在一个文件<br>叶子节点以聚集索引组织文件，即叶子节点存储了数据，不是像myisam的存储指针。主键索引和辅助索引有明显区分，辅助索引的叶子节点保存的是对应的主键索引关键字，再通过主键索引关键字去查主键索引的B+树，从而得到数据。这是为了减少索引的维护成本。所以innodb中主键就是聚集索引，非主键的索引就是非聚集索引。</p>
<h2 id="聚集索引"><a href="#聚集索引" class="headerlink" title="聚集索引"></a>聚集索引</h2><p>聚集索引的标准是该索引中键值的逻辑顺序决定了表中相应行的物理顺序</p>
<p>聚集索引对应的缺点就是修改慢，因为为了保证表中记录的物理和索引顺序一致，在记录插入的时候，会对数据页重新排序</p>
<p>MYISAM根本就没有 聚集索引<br>INNODB，主键就是 聚集索引，你也无法修改，每张InnoDB表只能创建一个聚集索引，聚集索引可以由一列或多列组成。首先选择显式定义的主键索引做为聚集索引；<br>如果没有，则选择第一个不允许NULL的唯一索引；还是没有的话，就采用InnoDB引擎内置的ROWID作为聚集索引；</p>
<h2 id="覆盖索引"><a href="#覆盖索引" class="headerlink" title="覆盖索引"></a>覆盖索引</h2><p>覆盖索引就是由索引直接返回查询数据，往往在联合索引中需要注意利用</p>
<h2 id="怎么选择"><a href="#怎么选择" class="headerlink" title="怎么选择"></a>怎么选择</h2><p>◆你的数据库有外键吗？<br>◆你需要事务支持吗？<br>◆你需要全文索引吗？<br>◆你经常使用什么样的查询模式？<br>◆你的数据有多大？<br>◆为什么一个节点为1页（16K）就够了？</p>
<p>　　对着上面Mysql中Innodb中对B+树的实际应用（主要看主键索引），可以发现B+树中的一个节点存储的内容是：</p>
<p>　　　　1. 非叶子节点：主键 + 指针</p>
<p>　　　　2. 叶子节点：数据</p>
<p>　　那么，假设我们一行数据大小为1K，那么一页就能存16条数据，也就是一个叶子节点能存16条数据；再看非叶子节点，假设主键ID为bigint类型，那么长度为8B，指针大小在Innodb源码中为6B，一共就是14B，那么一页里就可以存储16K/14=1170个(主键+指针)，那么一颗高度为2的B+树能存储的数据为：1170 <em> 16=18720条，一颗高度为3的B+树能存储的数据为：1170 </em> 1170 * 16=21902400（千万级条）。所以在InnoDB中B+树高度一般为1-3层，它就能满足千万级的数据存储。在查找数据时一次页的查找代表一次IO，所以通过主键索引查询通常只需要1-3次IO操作即可查找到数据。所以也就回答了我们的问题，1页=16k这么设置是比较合适的，是适用大多数的企业的，当然这个值是可以修改的，所以也能根据业务的时间情况进行调整。 </p>

      
      <!-- 打赏 -->
      
    </div>
    <footer class="article-footer">
      <a data-url="http://csspark.github.io/2019/04/17/mysql索引认知/" data-id="ck5d8fq3d000ngdgfq645x0ns" class="article-share-link">分享</a>
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mysql/">mysql</a></li></ul>

    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-consul实践" class="article article-type-post" itemscope="" itemprop="blogPost" data-scroll-reveal="">

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2019/04/10/consul实践/">consul实践</a>
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2019/04/10/consul实践/" class="article-date">
  <time datetime="2019-04-10T07:32:12.000Z" itemprop="datePublished">2019-04-10</time>
</a>
      
      
      
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      


      

      
      
      
      <!-- 打赏 -->
      
    </div>
    <footer class="article-footer">
      <a data-url="http://csspark.github.io/2019/04/10/consul实践/" data-id="ck5d8fq2w0003gdgf58xsf26g" class="article-share-link">分享</a>
      
    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-zookeeper实践" class="article article-type-post" itemscope="" itemprop="blogPost" data-scroll-reveal="">

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2019/04/10/zookeeper实践/">zookeeper实践</a>
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2019/04/10/zookeeper实践/" class="article-date">
  <time datetime="2019-04-10T07:31:44.000Z" itemprop="datePublished">2019-04-10</time>
</a>
      
      
      
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><h2 id="分布式系统的不可能三角"><a href="#分布式系统的不可能三角" class="headerlink" title="分布式系统的不可能三角"></a>分布式系统的不可能三角</h2><ul>
<li>Consistance (一致性)</li>
<li>Availability（可用）</li>
<li>Partition Tolerance（分区容错）</li>
</ul>
<p>移动互联网中的节奏越来越快，数据的一致性很重要</p>
<h2 id="分布式中的一致性问题解决方案"><a href="#分布式中的一致性问题解决方案" class="headerlink" title="分布式中的一致性问题解决方案"></a>分布式中的一致性问题解决方案</h2><ul>
<li><p>强一致性</p>
<ul>
<li>数据库主从同步，主库等待从库返回写入成功信号才继续，这样CA无法满足</li>
<li>Paxos</li>
<li>Raft </li>
<li>ZAB</li>
</ul>
</li>
<li><p>弱一致性（最终一致性）</p>
<ul>
<li>DNS</li>
<li>gossip协议（Cassandra）</li>
</ul>
</li>
</ul>
<h2 id="明确分布式系统CA存在问题与解决的思路"><a href="#明确分布式系统CA存在问题与解决的思路" class="headerlink" title="明确分布式系统CA存在问题与解决的思路"></a>明确分布式系统CA存在问题与解决的思路</h2><pre><code>1.数据不是单点，才叫分布式
2.不是单点，那就首先需要解决多个节点之间的数据一致性
3.多个节点时会出现一个名词：state machine replication （状态机复制）
    也就是一台机器发生改变的数据状态会以类似日志的形式记录下来，然后复制到多个节点上完成多个节点之间的数据转移。看来互联网的实质就是数据的移动也有一定道理。
4 显然问题转变为多个节点之间如何达成共识的问题（consensus）
    就是这些日志数据如何能都被节点机器正确有序的接收。因为互联网传输以及节点环境等因素在这中间就存在很多问题需要商量和确定，所以需要达成共识（consensus）
5 业界一般会把 state machine之间的consensus 等同与一致性。其实中间有一些差别，因为除了共识算法，还需要client的参与支持，比如主从同步中，可以用多数派的方法（共识算法）来解决一致性，但是最终完成一致性需要客户端能有序的执行指令才能做到。
6 共识算法paxos应运而生
    灵魂在于多数派的思想，只是有变种
    * basic paxos【乌托邦民主共和国】
        著名的两阶段提交，这个容易导致活锁，就是在第一阶段提案时遭遇别人提案后，重新提案，最终冤冤相报何时了...因为效率低，难实现所以就有了multi paxos

    * multi paxos【总统法治三权分立？】
        引入了leader的概念，就是提案者，唯一的，从此结束了群雄争霸的局面，有了leader就很好解决共识，因为提案都是一个发起，相当于减少了一个阶段的提交。那它如何保证可用性呢？此时涉及到选举的问题。当主节点出现问题之后，如何迅速有继任者。

    * raft可以理解是multi paxos的极简版，这里有https://raft.github.io/
        raft划分为三个问题：
            * leader选举
            * 日志复制
            * 确保一致性
        raft 划分为3种或两种角色
            * leader/candidate
            * follow
    * ZAB协议类似raft，都是multi paxos，一些称呼不同，leader周期zab叫epoch，raft为term，心跳方向相反，raft从上至下，zab自下而上。
</code></pre><h2 id="zookeeper的应用场景"><a href="#zookeeper的应用场景" class="headerlink" title="zookeeper的应用场景"></a>zookeeper的应用场景</h2><ul>
<li><p>分布式应用配置管理</p>
<p>发布与订阅即所谓的配置管理，顾名思义就是将数据发布到zk节点上，供订阅者动态获取数据，实现配置信息的集中式管理和动态更新。例如全局的配置信息，地址列表等就非常适合使用。</p>
</li>
<li><p>分布式通知/协调</p>
<p>ZooKeeper中特有watcher注册与异步通知机制，能够很好的实现分布式环境下不同系统之间的通知与协调，实现对数据变更的实时处理，使用方法：通常是不同系统都对ZK上同一个znode进行watch，监听znode的变化（包括znode本身内容及子节点的），其中一个系统update了 znode，那么另一个系统能够收到通知，并作出相应处理。</p>
</li>
<li><p>分布式锁</p>
<p>分布式锁，这个主要得益于ZooKeeper为我们保证了数据的强一致性，zk集群中任意节点（一个zk server）上的相同znode的数据是一定是相同的。<br>锁服务可以分为两类，一个是保持独占，另一个是控制时序</p>
</li>
<li><p>集群管理</p>
<p>Hbase Master选举则是zookeeper经典的使用场景</p>
</li>
<li>分布式队列</li>
</ul>
<p>个人觉得主要是前两个应用</p>
<h2 id="实践操作"><a href="#实践操作" class="headerlink" title="实践操作"></a>实践操作</h2><p>docker-compose.yml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">version: &apos;3.1&apos;</span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  zoo1:</span><br><span class="line">    image: zookeeper</span><br><span class="line">    restart: always</span><br><span class="line">    hostname: zoo1</span><br><span class="line">    ports:</span><br><span class="line">      - 2181:2181</span><br><span class="line">    environment:</span><br><span class="line">      ZOO_MY_ID: 1</span><br><span class="line">      ZOO_SERVERS: server.1=0.0.0.0:2888:3888 server.2=zoo2:2888:3888 server.3=zoo3:2888:3888</span><br><span class="line"></span><br><span class="line">  zoo2:</span><br><span class="line">    image: zookeeper</span><br><span class="line">    restart: always</span><br><span class="line">    hostname: zoo2</span><br><span class="line">    ports:</span><br><span class="line">      - 2182:2181</span><br><span class="line">    environment:</span><br><span class="line">      ZOO_MY_ID: 2</span><br><span class="line">      ZOO_SERVERS: server.1=zoo1:2888:3888 server.2=0.0.0.0:2888:3888 server.3=zoo3:2888:3888</span><br><span class="line"></span><br><span class="line">  zoo3:</span><br><span class="line">    image: zookeeper</span><br><span class="line">    restart: always</span><br><span class="line">    hostname: zoo3</span><br><span class="line">    ports:</span><br><span class="line">      - 2183:2181</span><br><span class="line">    environment:</span><br><span class="line">      ZOO_MY_ID: 3</span><br><span class="line">      ZOO_SERVERS: server.1=zoo1:2888:3888 server.2=zoo2:2888:3888 server.3=0.0.0.0:2888:3888</span><br></pre></td></tr></table></figure>
<h2 id="安装zk客户端管理工具"><a href="#安装zk客户端管理工具" class="headerlink" title="安装zk客户端管理工具"></a>安装zk客户端管理工具</h2><p><a href="https://github.com/ireaderlab/zkdash.git" target="_blank" rel="noopener">zkdash</a></p>
<h2 id="zk基本命令"><a href="#zk基本命令" class="headerlink" title="zk基本命令"></a>zk基本命令</h2><ol>
<li>启动ZK服务: bin/zkServer.sh start</li>
<li>查看ZK服务状态: bin/zkServer.sh status</li>
<li>停止ZK服务: bin/zkServer.sh stop</li>
<li>重启ZK服务: bin/zkServer.sh restart </li>
<li>连接服务器: zkCli.sh -server 127.0.0.1:2181</li>
<li>ls [path]</li>
<li>create [path] [value]</li>
<li>get/set [path] [value]</li>
<li>quit<br>10.help</li>
</ol>
<h2 id="zk示例代码"><a href="#zk示例代码" class="headerlink" title="zk示例代码"></a>zk示例代码</h2><p><a href="https://github.com/php-zookeeper/php-zookeeper/blob/master/examples/Zookeeper_Example.php" target="_blank" rel="noopener">php demo</a></p>
<p>watch功能可能需要非安全线程版本的php<br><a href="https://www.imooc.com/article/31703" target="_blank" rel="noopener">https://www.imooc.com/article/31703</a></p>

      
      <!-- 打赏 -->
      
    </div>
    <footer class="article-footer">
      <a data-url="http://csspark.github.io/2019/04/10/zookeeper实践/" data-id="ck5d8fq3n0013gdgfq9qcq200" class="article-share-link">分享</a>
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/zookeeper-docker/">zookeeper,docker</a></li></ul>

    </footer>

  </div>

  

  
  
  

  

</article>
    
  </article>
  

  
  <nav class="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/2/">上一页</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/4/">下一页</a>
  </nav>
  
</section>
</div>

      <footer class="footer">
  <div class="outer">
    <ul class="list-inline">
      <li>
        &copy;
        2015-2020
        Spark
      </li>
      <li>
        
          Powered by
        
        
        <a href="https://hexo.io" target="_blank">Hexo</a> Theme <a href="https://github.com/Shen-Yu/hexo-theme-ayer" target="_blank">Ayer</a>
        
      </li>
    </ul>
    <ul class="list-inline">
      <li>
        
        
        <ul class="list-inline">
  <li>PV:<span id="busuanzi_value_page_pv"></span></li>
  <li>UV:<span id="busuanzi_value_site_uv"></span></li>
</ul>
        
      </li>
      <li>
        <!-- cnzz统计 -->
        
        <script type="text/javascript" src="https://s9.cnzz.com/z_stat.php?id=1278069914&amp;web_id=1278069914"></script>
        
      </li>
    </ul>
  </div>
</footer>
    <div class="to_top">
        <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>
      </div>
    </main>
    
      <aside class="sidebar">
        
        <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/ayer-side.svg" alt="Spark的博客"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">目录</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">标签</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags/旅行/">旅行</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="http://shenyu-vip.lofter.com">摄影</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/2019/about">关于我</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search" title="搜索">
        <i class="ri-search-line"></i>
      </a>
      
      
      <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
        <i class="ri-rss-line"></i>
      </a>
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
      </aside>
      <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>请我喝杯咖啡吧~</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="/images/alipay.jpg">
      <span class="reward-type">支付宝</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="/images/wechat.jpg">
      <span class="reward-type">微信</span>
    </div>
    
  </div>
</div>
      <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.justifiedGallery.min.js"></script>
<script src="/js/lazyload.min.js"></script>
<script src="/js/busuanzi-2.3.pure.min.js"></script>

  <script src="/fancybox/jquery.fancybox.min.js"></script>




<script>
  var ayerConfig = {
    mathjax: false
  }
</script>

<script src="/js/ayer.js"></script>

<script src="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.css">



<script type="text/javascript" src="https://js.users.51.la/20544303.js"></script>
  
  

  </div>
</body>

</html>